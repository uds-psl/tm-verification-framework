<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="../">Project Page</a>
      <a href="./indexpage.html"> Index </a>
      <a href="./toc.html"> Table of Contents </a>
    </span>
</div>
    <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="main">
<div class="code">
</div>

<div class="doc">
<a name="lab305"></a><h1 class="section">Theorem: Univ can simulate multi-tape Turing machines with polynominal time and linear space overhead</h1>

</div>
<div class="code">

<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Undecidability</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">TM.Code.ProgrammingTools</span>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Undecidability</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">TM.Univ.StepTM</span>. <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">Univ</span></span>&nbsp;for&nbsp;single-tape&nbsp;Turing&nbsp;machines&nbsp;*)</span><br/>
<span class="id" title="var">From</span> <span class="id" title="var">Undecidability</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">TM.Single.EncodeTapes</span> <span class="id" title="var">TM.Single.StepTM</span>. <span class="comment">(*&nbsp;Compiler&nbsp;for&nbsp;multi-tape&nbsp;Turing&nbsp;machines&nbsp;to&nbsp;single-tape&nbsp;Turing&nbsp;machines&nbsp;*)</span><br/>

<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Undecidability</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">PrettyBounds</span>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Undecidability</span> <span class="id" title="keyword">Require</span> <span class="id" title="var">UnivBounds</span>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Undecidability</span> <span class="id" title="keyword">Require</span> <span class="id" title="var">UnivSpaceBounds</span>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Undecidability</span> <span class="id" title="keyword">Require</span> <span class="id" title="var">M2MBounds</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Derive</span>.<br/>

<br/>
<span class="id" title="keyword">Local</span> <span class="id" title="var">Arguments</span> <span class="id" title="var">loopM</span> {<span class="id" title="var">_</span> <span class="id" title="var">_</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Local</span> <span class="id" title="var">Arguments</span> <span class="id" title="var">halt</span> {<span class="id" title="var">_</span> <span class="id" title="var">_</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Local</span> <span class="id" title="var">Arguments</span> <span class="id" title="var">step</span> {<span class="id" title="var">_</span> <span class="id" title="var">_</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>

<br/>
<span class="comment">(*<br/>
Lemma&nbsp;vector_const_nil&nbsp;(X&nbsp;:&nbsp;Type)&nbsp;(x&nbsp;:&nbsp;X)&nbsp;:<br/>
&nbsp;&nbsp;Vector.const&nbsp;x&nbsp;0&nbsp;=&nbsp;Vector.nil&nbsp;_.<br/>
Proof.&nbsp;reflexivity.&nbsp;Qed.<br/>
<br/>
Lemma&nbsp;vector_const_cons&nbsp;(X&nbsp;:&nbsp;Type)&nbsp;(n&nbsp;:&nbsp;nat)&nbsp;(x&nbsp;:&nbsp;X)&nbsp;:<br/>
&nbsp;&nbsp;Vector.const&nbsp;x&nbsp;(S&nbsp;n)&nbsp;=&nbsp;x&nbsp;:::&nbsp;Vector.const&nbsp;x&nbsp;n.<br/>
Proof.&nbsp;cbn.&nbsp;reflexivity.&nbsp;Qed.<br/>
*)</span><br/>

<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Undecidability</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">MaxList</span>.<br/>

<br/>
</div>

<div class="doc">
Technical compatibility lemma: Coq's standard library is soo inconsistent... 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fold_left_vector_to_list</span> (<span class="id" title="var">X</span> <span class="id" title="var">Y</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">Y</span> -&gt; <span class="id" title="var">X</span> -&gt; <span class="id" title="var">Y</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">Y</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">Vector.fold_left</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> = <span class="id" title="var">fold_left</span> <span class="id" title="var">f</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">v</span>) <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">revert</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">v</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">x</span> <span class="id" title="var">n</span> <span class="id" title="var">v</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">max_list_rec_eq_foldl</span> (<span class="id" title="var">a</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">max</span> <span class="id" title="var">xs</span> <span class="id" title="var">a</span> = <span class="id" title="var">max_list_rec</span> <span class="id" title="var">a</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">max_list_rec_max</span>. <span class="id" title="var">nia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sizeOfmTapes_max_list_map</span> (<span class="id" title="var">sig</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sig</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> = <span class="id" title="var">max_list_map</span> (@<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">_</span>) (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">sizeOfmTapes</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">fold_left_vector_to_list</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">vector_to_list_map</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">max_list_map</span>, <span class="id" title="var">max_list</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">max_list_rec_eq_foldl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">max_list_rec_repeat</span> (<span class="id" title="var">a</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">n</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">max_list_rec</span> <span class="id" title="var">s</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span>) = <span class="id" title="var">max</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;refine&nbsp;(@complete_induction&nbsp;(fun&nbsp;n&nbsp;=&gt;&nbsp;forall&nbsp;s,&nbsp;n&nbsp;&lt;&gt;&nbsp;0&nbsp;-&gt;&nbsp;max_list_rec&nbsp;s&nbsp;(repeat&nbsp;a&nbsp;n)&nbsp;=&nbsp;Init.Nat.max&nbsp;s&nbsp;a)&nbsp;n&nbsp;_).&nbsp;clear&nbsp;n.&nbsp;intros&nbsp;<span class="inlinecode"></span> <span class="inlinecode">|</span> <span class="inlinecode"><span class="id" title="var">n</span></span>&nbsp;IH&nbsp;s.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">n</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">cbn</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> [].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>. <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">change</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="var">a</span> (<span class="id" title="var">S</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>))) <span class="id" title="keyword">with</span> (<span class="id" title="var">a</span> :: <span class="id" title="tactic">repeat</span> <span class="id" title="var">a</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)). <span class="id" title="var">cbn</span> [<span class="id" title="var">max_list_rec</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">congruence</span>. <span class="id" title="var">nia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">max_list_map_repeat</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">X</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">n</span> &lt;&gt; 0 -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">max_list_map</span> <span class="id" title="var">f</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span>) = <span class="id" title="var">f</span> <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">max_list_map</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_repeat</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">max_list_rec_repeat</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_const_to_list</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">X</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">vector_to_list</span> (<span class="id" title="var">Vector.const</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span>) = <span class="id" title="tactic">repeat</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="var">now</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_to_list_In</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">X</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">xs</span>) &lt;-&gt; <span class="id" title="var">Vector.In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">y</span> <span class="id" title="var">n</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [ &lt;- | <span class="id" title="var">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">y</span> <span class="id" title="var">n</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">inv</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">In_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [&lt;- | <span class="id" title="var">H</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sizeOfmTapes_upperBound</span> (<span class="id" title="var">sig</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">tps</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sig</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">t</span>, <span class="id" title="var">Vector.In</span> <span class="id" title="var">t</span> <span class="id" title="var">tps</span> -&gt; <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">t</span> &lt;= <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">tps</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">sizeOfmTapes_max_list_map</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">max_list_map_ge</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">vector_to_list_In</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*<br/>
<span class="comment">(**&nbsp;Create&nbsp;a&nbsp;bogus&nbsp;tape&nbsp;of&nbsp;some&nbsp;size&nbsp;*)</span><br/>
Section&nbsp;MakeBogusTape.<br/>
<br/>
&nbsp;&nbsp;Variable&nbsp;(sig&nbsp;:&nbsp;Type)&nbsp;(defSig&nbsp;:&nbsp;inhabitedC&nbsp;sig).<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;bogus_tape&nbsp;(k&nbsp;:&nbsp;nat)&nbsp;:&nbsp;tape&nbsp;sig&nbsp;:=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;k&nbsp;with<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;0&nbsp;=&gt;&nbsp;niltape&nbsp;_<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;S&nbsp;k'&nbsp;=&gt;&nbsp;midtape&nbsp;nil&nbsp;default&nbsp;(repeat&nbsp;default&nbsp;k')<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end.<br/>
<br/>
&nbsp;&nbsp;Lemma&nbsp;bogus_tape_sizeOfTape&nbsp;(k&nbsp;:&nbsp;nat)&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;sizeOfTape&nbsp;(bogus_tape&nbsp;k)&nbsp;=&nbsp;k.<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;k&nbsp;as&nbsp;<span class="inlinecode"></span> <span class="inlinecode">|</span> <span class="inlinecode"><span class="id" title="var">k'</span></span>;&nbsp;cbn.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;reflexivity.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;now&nbsp;rewrite&nbsp;repeat_length.<br/>
&nbsp;&nbsp;Qed.<br/>
<br/>
&nbsp;&nbsp;Definition&nbsp;bogus_tapes&nbsp;{n&nbsp;:&nbsp;nat}&nbsp;(k&nbsp;:&nbsp;nat)&nbsp;:&nbsp;Vector.t&nbsp;(tape&nbsp;sig)&nbsp;n&nbsp;:=&nbsp;Vector.const&nbsp;(bogus_tape&nbsp;k)&nbsp;n.<br/>
<br/>
&nbsp;&nbsp;Lemma&nbsp;bogus_tapes_sizeOfmTapes&nbsp;(n&nbsp;k&nbsp;:&nbsp;nat)&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&gt;&nbsp;0&nbsp;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;sizeOfmTapes&nbsp;(@bogus_tapes&nbsp;n&nbsp;k)&nbsp;=&nbsp;k.<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;unfold&nbsp;bogus_tapes.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;intros.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;setoid_rewrite&nbsp;sizeOfmTapes_max_list_map.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;vector_const_to_list.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;max_list_map_repeat&nbsp;by&nbsp;assumption.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;bogus_tape_sizeOfTape.<br/>
&nbsp;&nbsp;Qed.<br/>
<br/>
End&nbsp;MakeBogusTape.<br/>
<br/>
Arguments&nbsp;bogus_tape&nbsp;{sig&nbsp;defSig}&nbsp;k.<br/>
Arguments&nbsp;bogus_tape&nbsp;:&nbsp;simpl&nbsp;never.<br/>
<br/>
*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">terminates</span> (<span class="id" title="var">sigM</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">tp</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">tp'</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>), <span class="id" title="var">loopM</span> <span class="id" title="var">_</span> (<span class="id" title="var">initc</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span>) <span class="id" title="var">k</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">mk_mconfig</span> <span class="id" title="var">q</span> <span class="id" title="var">tp'</span>).<br/>

<br/>
</div>

<div class="doc">
I forgot to write this function... 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">ToSingleTape_steps</span> (<span class="id" title="var">sigM</span> <span class="id" title="var">F</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">pM</span> : <span class="id" title="var">pTM</span> <span class="id" title="var">sigM</span> <span class="id" title="var">F</span> <span class="id" title="var">n</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> := <span class="id" title="var">Single.StepTM.Loop_steps</span> (<span class="id" title="var">start</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>)) <span class="id" title="var">T</span> <span class="id" title="var">k</span>.<br/>

<br/>
</div>

<div class="doc">
Apply a size-function to every tape 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">apply_sizeFun</span> {<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">Vector.t</span> (<span class="id" title="var">nat</span>-&gt;<span class="id" title="var">nat</span>) <span class="id" title="var">n</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> <span class="id" title="var">n</span>) : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> <span class="id" title="var">n</span> := <span class="id" title="var">tabulate</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="var">f</span> @&gt; <span class="id" title="var">i</span> <span class="id" title="var">s</span>[@<span class="id" title="var">i</span>]).<br/>

<br/>
</div>

<div class="doc">
Create the initial tapes of <span class="inlinecode"><span class="id" title="var">Univ</span></span>, given a single-tape machine <span class="inlinecode"><span class="id" title="var">M</span></span> and a tape <span class="inlinecode"><span class="id" title="var">t</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="var">InitUniv</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">sigM</span> <span class="id" title="var">sig</span> : <span class="id" title="var">finType</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">sigGraph</span> := (<span class="id" title="var">sigList</span> (<span class="id" title="var">sigPair</span> (<span class="id" title="var">sigPair</span> (<span class="id" title="var">option</span> <span class="id" title="var">sigM</span>) <span class="id" title="var">sigState</span>) (<span class="id" title="var">sigPair</span> (<span class="id" title="var">option</span> <span class="id" title="var">sigM</span> * <span class="id" title="tactic">move</span>) <span class="id" title="var">sigState</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">retr_sigGraph_sig</span> : <span class="id" title="var">Retract</span> <span class="id" title="var">sigGraph</span> <span class="id" title="var">sig</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">retr_sigTape_sig</span> : <span class="id" title="var">Retract</span> <span class="id" title="var">sigM</span> <span class="id" title="var">sig</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">Derive</span> <span class="id" title="var">makeUnivWorkingTape</span> <span class="id" title="var">SuchThat</span> (<span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>), <span class="id" title="var">containsWorkingTape</span> <span class="id" title="var">retr_sigTape_sig</span> (<span class="id" title="var">makeUnivWorkingTape</span> <span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sig</span>^+) <span class="id" title="var">T</span>) <span class="id" title="var">As</span> <span class="id" title="var">makeUnivWorkingTape_correct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">makeUnivWorkingTape</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="keyword">fun</span> <span class="id" title="var">T</span> =&gt; <span class="id" title="var">_</span>). <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">containsWorkingTape_iff</span> (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sig</span>^+) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsWorkingTape</span> <span class="id" title="var">_</span> <span class="id" title="var">tp</span> <span class="id" title="var">T</span> &lt;-&gt; <span class="id" title="var">tp</span> = <span class="id" title="var">makeUnivWorkingTape</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> -&gt;. <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivWorkingTape_correct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">Derive</span> <span class="id" title="var">makeUnivGraphTape</span> <span class="id" title="var">SuchThat</span> (<span class="id" title="keyword">forall</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1), <span class="id" title="var">containsTrans_size</span> <span class="id" title="var">retr_sigGraph_sig</span> (<span class="id" title="var">makeUnivGraphTape</span> <span class="id" title="var">M</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sig</span>^+) <span class="id" title="var">M</span> 0) <span class="id" title="var">As</span> <span class="id" title="var">makeUnivGraphTape_correct_size</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">makeUnivGraphTape</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="keyword">fun</span> <span class="id" title="var">M</span> =&gt; <span class="id" title="var">_</span>). <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">containsTrans</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">initValue_contains_size</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeUnivGraphTape_correct</span> <span class="id" title="var">M</span> : <span class="id" title="var">containsTrans</span> <span class="id" title="var">_</span> (<span class="id" title="var">makeUnivGraphTape</span> <span class="id" title="var">M</span>) <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">containsTrans_size_containsTrans</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivGraphTape_correct_size</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">Derive</span> <span class="id" title="var">makeUnivStartStateTape</span> <span class="id" title="var">SuchThat</span> (<span class="id" title="keyword">forall</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1), <span class="id" title="var">containsState_size</span> <span class="id" title="var">retr_sigGraph_sig</span> (<span class="id" title="var">makeUnivStartStateTape</span> <span class="id" title="var">M</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sig</span>^+) (<span class="id" title="var">start</span> <span class="id" title="var">M</span>) 0) <span class="id" title="var">As</span> <span class="id" title="var">makeUnivStartStateTape_correct_size</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">makeUnivStartStateTape</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="keyword">fun</span> <span class="id" title="var">M</span> =&gt; <span class="id" title="var">_</span>). <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">containsState</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">initValue_contains_size</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeUnivStartStateTape_correct</span> <span class="id" title="var">M</span> : <span class="id" title="var">containsState</span> <span class="id" title="var">_</span> (<span class="id" title="var">makeUnivStartStateTape</span> <span class="id" title="var">M</span>) (<span class="id" title="var">start</span> <span class="id" title="var">M</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">containsState_size_containsState</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivStartStateTape_correct_size</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">makeUnivTapes</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) : <span class="id" title="var">tapes</span> <span class="id" title="var">sig</span>^+ 6 :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[| <span class="id" title="var">makeUnivWorkingTape</span> <span class="id" title="var">t</span>; <span class="id" title="var">makeUnivGraphTape</span> <span class="id" title="var">M</span>; <span class="id" title="var">makeUnivStartStateTape</span> <span class="id" title="var">M</span>; <span class="id" title="var">initRight</span> <span class="id" title="var">_</span>; <span class="id" title="var">initRight</span> <span class="id" title="var">_</span>; <span class="id" title="var">initRight</span> <span class="id" title="var">_</span> |].<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeUnivTapes_correct_size</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsWorkingTape</span> <span class="id" title="var">_</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span>)[@<span class="id" title="var">Fin0</span>] <span class="id" title="var">tp</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsTrans_size</span> <span class="id" title="var">_</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span>)[@<span class="id" title="var">Fin1</span>] <span class="id" title="var">M</span> 0 /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsState_size</span> <span class="id" title="var">_</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span>)[@<span class="id" title="var">Fin2</span>] (<span class="id" title="var">start</span> <span class="id" title="var">M</span>) 0 /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> (<span class="id" title="var">i</span> : <span class="id" title="var">Fin.t</span> 3), <span class="id" title="var">isRight_size</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span>)[@<span class="id" title="var">FinR</span> 3 <span class="id" title="var">i</span>] 0).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">makeUnivTapes</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span> ]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivWorkingTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivGraphTape_correct_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivStartStateTape_correct_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>; <span class="id" title="var">destruct_fin</span> <span class="id" title="var">i</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">initRight_isRight_size</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeUnivTapes_correct</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsWorkingTape</span> <span class="id" title="var">_</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span>)[@<span class="id" title="var">Fin0</span>] <span class="id" title="var">tp</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsTrans</span> <span class="id" title="var">_</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span>)[@<span class="id" title="var">Fin1</span>] <span class="id" title="var">M</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsState</span> <span class="id" title="var">_</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span>)[@<span class="id" title="var">Fin2</span>] (<span class="id" title="var">start</span> <span class="id" title="var">M</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> (<span class="id" title="var">i</span> : <span class="id" title="var">Fin.t</span> 3), <span class="id" title="var">isRight</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span>)[@<span class="id" title="var">FinR</span> 3 <span class="id" title="var">i</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">makeUnivTapes</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span> ]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivWorkingTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivGraphTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivStartStateTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>; <span class="id" title="var">destruct_fin</span> <span class="id" title="var">i</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">initRight_isRight</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">InitUniv</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_to_list_nil</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">vector_to_list</span> [||] = @<span class="id" title="var">nil</span> <span class="id" title="var">X</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_to_list_cons</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">X</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">vector_to_list</span> (<span class="id" title="var">x</span> ::: <span class="id" title="var">xs</span>) = <span class="id" title="var">x</span> :: <span class="id" title="var">vector_to_list</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">vector_sum</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">nat</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">xs</span> =&gt; <span class="id" title="var">Vector.fold_left</span> <span class="id" title="var">plus</span> 0 (<span class="id" title="var">Vector.map</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_sum_shift</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">Vector.fold_left</span> <span class="id" title="var">plus</span> <span class="id" title="var">a</span> (<span class="id" title="var">Vector.map</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span>) = <span class="id" title="var">vector_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span> + <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">x</span> <span class="id" title="var">n</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">at</span> 2. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">at</span> 1. <span class="id" title="tactic">omega</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Coq's&nbsp;standard&nbsp;library&nbsp;is&nbsp;sooo&nbsp;inconsistent...&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">list_sum</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) : <span class="id" title="var">list</span> <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">xs</span> =&gt; <span class="id" title="var">fold_left</span> <span class="id" title="var">plus</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span>) 0.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_sum_shift</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">plus</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span>) <span class="id" title="var">a</span> = <span class="id" title="var">list_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span> + <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">at</span> 2. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">at</span> 1. <span class="id" title="tactic">omega</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_to_list_sum</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">list_sum</span> <span class="id" title="var">f</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">xs</span>) = <span class="id" title="var">vector_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">x</span> <span class="id" title="var">n</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">vector_sum_shift</span>, <span class="id" title="var">list_sum_shift</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_sum_monotone</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>) (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">Vector.In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">f1</span> <span class="id" title="var">x</span> &lt;= <span class="id" title="var">f2</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">vector_sum</span> <span class="id" title="var">f1</span> <span class="id" title="var">xs</span> &lt;= <span class="id" title="var">vector_sum</span> <span class="id" title="var">f2</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">x</span> <span class="id" title="var">n</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">vector_sum_shift</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">constructor</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_sum_monotone_plus</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>) (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">Vector.In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">f1</span> <span class="id" title="var">x</span> &lt;= <span class="id" title="var">f2</span> <span class="id" title="var">x</span> + <span class="id" title="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">vector_sum</span> <span class="id" title="var">f1</span> <span class="id" title="var">xs</span> &lt;= <span class="id" title="var">vector_sum</span> <span class="id" title="var">f2</span> <span class="id" title="var">xs</span> + <span class="id" title="var">a</span> * <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">x</span> <span class="id" title="var">n</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">vector_sum_shift</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.mul_succ_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>). <span class="id" title="tactic">omega</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_sum_monotone_plus'</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>) (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">Vector.In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">f1</span> <span class="id" title="var">x</span> + <span class="id" title="var">a</span> &lt;= <span class="id" title="var">f2</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">vector_sum</span> <span class="id" title="var">f1</span> <span class="id" title="var">xs</span> + <span class="id" title="var">a</span> * <span class="id" title="var">n</span> &lt;= <span class="id" title="var">vector_sum</span> <span class="id" title="var">f2</span> <span class="id" title="var">xs</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">x</span> <span class="id" title="var">n</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">vector_sum_shift</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.mul_succ_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IH</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>). <span class="id" title="tactic">omega</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">MakeSingleTape</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">sigM</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>). <span class="comment">(*&nbsp;We&nbsp;need&nbsp;<span class="inlinecode"><span class="id" title="var">finType</span></span>&nbsp;here,&nbsp;because&nbsp;<span class="inlinecode"><span class="id" title="var">contains_tapes</span></span>&nbsp;is&nbsp;defined&nbsp;over&nbsp;<span class="inlinecode"><span class="id" title="var">finType</span></span>&nbsp;(bug)&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">Derive</span> <span class="id" title="var">makeSingleTape</span> <span class="id" title="var">SuchThat</span> (<span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>), <span class="id" title="var">contains_tapes</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">_</span>) <span class="id" title="var">T</span>) <span class="id" title="var">As</span> <span class="id" title="var">makeSingleTape_correct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">makeSingleTape</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="keyword">fun</span> <span class="id" title="var">T</span> =&gt; <span class="id" title="var">_</span>). <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">contains_tapes_injective</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) <span class="id" title="var">tp1</span> <span class="id" title="var">tp2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_tapes</span> <span class="id" title="var">tp1</span> <span class="id" title="var">T</span> -&gt; <span class="id" title="var">contains_tapes</span> <span class="id" title="var">tp2</span> <span class="id" title="var">T</span> -&gt; <span class="id" title="var">tp1</span> = <span class="id" title="var">tp2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">contains_tapes</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> -&gt; -&gt;. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">contains_tapes_iff</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) <span class="id" title="var">tp</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_tapes</span> <span class="id" title="var">tp</span> <span class="id" title="var">T</span> &lt;-&gt; <span class="id" title="var">tp</span> = <span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> -&gt;; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">makeSingleTape_correct</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Size of <span class="inlinecode"><span class="id" title="var">makeSingleTape</span></span> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Encode_tape_size</span> (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">tp</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">niltape</span> <span class="id" title="var">_</span> =&gt; 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">tp</span> + 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Encode_tape_hasSize</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>), <span class="id" title="var">size</span> <span class="id" title="var">tp</span> = <span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">size</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">tp</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">progress</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">simpl_list</span>); <span class="id" title="tactic">omega</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Encode_tape_hasSize_le</span> (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp</span> &lt;= <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">tp</span> + 2.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">tp</span>; <span class="id" title="var">cbn</span> -[<span class="id" title="var">sizeOfTape</span>]; <span class="id" title="tactic">omega</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Encode_tapes_hasSize</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>), <span class="id" title="var">size</span> <span class="id" title="var">T</span> = <span class="id" title="var">vector_sum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">t</span> + 1) <span class="id" title="var">T</span> + 1.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">size</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">encode_tapes</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_list_hasSize</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">cX</span> := <span class="id" title="var">Encode_tape</span> <span class="id" title="var">sigM</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">T</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">t</span> <span class="id" title="var">n</span> <span class="id" title="var">T</span> <span class="id" title="var">IH</span>]; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Encode_tape_hasSize</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">vector_sum_shift</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeSingleTape_sizeOfTape</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sizeOfTape</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) &lt;= <span class="id" title="var">vector_sum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">tp</span> =&gt; <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">tp</span> + 2) <span class="id" title="var">T</span> + <span class="id" title="var">n</span> + 3.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">tapes</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">unfold</span> <span class="id" title="var">makeSingleTape</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">simpl_list</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize</span>. <span class="id" title="var">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">add_le_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">vector_sum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> (<span class="id" title="var">eqType_X</span> (<span class="id" title="keyword">type</span> <span class="id" title="var">sigM</span>)) =&gt; <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">tp</span> + 2) <span class="id" title="var">T</span> + (1 * <span class="id" title="var">n</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">vector_sum_monotone_plus</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">_</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Encode_tape_hasSize_le</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Exact version 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeSingleTape_sizeOfTape'</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sizeOfTape</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) = <span class="id" title="var">vector_sum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">tp</span> =&gt; <span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp</span> + 1) <span class="id" title="var">T</span> + 3.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">tapes</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">unfold</span> <span class="id" title="var">makeSingleTape</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">simpl_list</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize</span>. <span class="id" title="var">now</span> <span class="id" title="var">ring_simplify</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">isRight_size_hasSize</span> (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">isRight_size</span> <span class="id" title="var">tp</span> <span class="id" title="var">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp</span> &lt;= <span class="id" title="var">s</span> + 3.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> (<span class="id" title="var">x</span>&amp;<span class="id" title="var">ls</span>&amp;-&gt;&amp;<span class="id" title="var">Hs</span>). <span class="id" title="var">cbn</span>. <span class="id" title="var">simpl_list</span>; <span class="id" title="var">cbn</span>. <span class="id" title="var">ring_simplify</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hs</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">MakeSingleTape</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeSingleTape_size'</span> (<span class="id" title="var">sigM</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">Encode_tape_size</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) = <span class="id" title="var">vector_sum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">tp</span> =&gt; <span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp</span> + 1) <span class="id" title="var">T</span> + 5.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">makeSingleTape</span>. <span class="id" title="tactic">repeat</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">simpl_list</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">change</span> (| <span class="id" title="var">encode_tapes</span> <span class="id" title="var">T</span> |) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">ring_simplify</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeSingleTape_size</span> (<span class="id" title="var">sigM</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">size</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) = <span class="id" title="var">vector_sum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">tp</span> =&gt; <span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp</span> + 1) <span class="id" title="var">T</span> + 5.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tape_hasSize</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">makeSingleTape_size'</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*<br/>
Definition&nbsp;sigTM&nbsp;(sigM&nbsp;:&nbsp;finType)&nbsp;(n&nbsp;:&nbsp;nat)&nbsp;(M&nbsp;:&nbsp;mTM&nbsp;sigM&nbsp;n)&nbsp;:&nbsp;finType&nbsp;:=&nbsp;sigM.<br/>
Arguments&nbsp;sigTM&nbsp;{sigM&nbsp;n}&nbsp;M.<br/>
*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">vector_1_eta</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> 1) :<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>, <span class="id" title="var">v</span> = [| <span class="id" title="var">x</span> |].<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">destruct_vector</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">graph_of_fun_ext</span> (<span class="id" title="var">A</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f1</span> <span class="id" title="var">f2</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) :<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>), <span class="id" title="var">f1</span> <span class="id" title="var">a</span> = <span class="id" title="var">f2</span> <span class="id" title="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">graph_of_fun</span> <span class="id" title="var">f1</span> = <span class="id" title="var">graph_of_fun</span> <span class="id" title="var">f2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">graph_of_fun</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">List.map_ext</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Local</span> <span class="id" title="var">Arguments</span> <span class="id" title="var">liftState</span> {<span class="id" title="var">n</span> <span class="id" title="var">sig</span> <span class="id" title="var">F1</span> <span class="id" title="var">F2</span> <span class="id" title="var">pM</span>} (<span class="id" title="var">l</span> <span class="id" title="var">q</span>).<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">StateWhile_irrelevant</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">sig</span> : <span class="id" title="var">finType</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">F1</span> <span class="id" title="var">F2</span> : <span class="id" title="var">finType</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">pM</span> : <span class="id" title="var">F1</span> -&gt; <span class="id" title="var">pTM</span> <span class="id" title="var">sig</span> (<span class="id" title="var">F1</span> + <span class="id" title="var">F2</span>) 1.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> (<span class="id" title="var">defF</span> : <span class="id" title="var">inhabitedC</span> <span class="id" title="var">F2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">StateWhile_graph_irrelevant</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">F1</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">graph_of_TM</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">StateWhile</span> <span class="id" title="var">pM</span> <span class="id" title="var">l1</span>)) = <span class="id" title="var">graph_of_TM</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">StateWhile</span> <span class="id" title="var">pM</span> <span class="id" title="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">graph_of_TM</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">StateWhile_irrelevant</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">StateWhile_irrelevant'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">sig</span> : <span class="id" title="var">finType</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">n</span> : <span class="id" title="var">nat</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">F1</span> <span class="id" title="var">F2</span> : <span class="id" title="var">finType</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> <span class="id" title="var">pM</span> : <span class="id" title="var">F1</span> -&gt; <span class="id" title="var">pTM</span> <span class="id" title="var">sig</span> (<span class="id" title="var">F1</span> + <span class="id" title="var">F2</span>) <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> (<span class="id" title="var">defF</span> : <span class="id" title="var">inhabitedC</span> <span class="id" title="var">F2</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">StateWhile_halt_irrelevant</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">F1</span>) <span class="id" title="var">q</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">halt</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">StateWhile</span> <span class="id" title="var">pM</span> <span class="id" title="var">l1</span>)) (<span class="id" title="var">liftState</span> <span class="id" title="var">l1</span> <span class="id" title="var">q</span>) = <span class="id" title="var">halt</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">StateWhile</span> <span class="id" title="var">pM</span> <span class="id" title="var">l2</span>)) (<span class="id" title="var">liftState</span> <span class="id" title="var">l1</span> <span class="id" title="var">q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">StateWhile_halt_irrelevant'</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">F1</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">StateWhile_states</span> <span class="id" title="var">pM</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">halt</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">StateWhile</span> <span class="id" title="var">pM</span> <span class="id" title="var">l1</span>)) <span class="id" title="var">q</span> = <span class="id" title="var">halt</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">StateWhile</span> <span class="id" title="var">pM</span> <span class="id" title="var">l2</span>)) <span class="id" title="var">q</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">StateWhile_index_irrelevant</span> (<span class="id" title="var">l1</span> <span class="id" title="var">l2</span> : <span class="id" title="var">F1</span>) <span class="id" title="var">q</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">index</span> (<span class="id" title="var">liftState</span> <span class="id" title="var">l1</span> <span class="id" title="var">q</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">StateWhile</span> <span class="id" title="var">pM</span> <span class="id" title="var">l1</span>))) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">index</span> (<span class="id" title="var">liftState</span> <span class="id" title="var">l1</span> <span class="id" title="var">q</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">StateWhile</span> <span class="id" title="var">pM</span> <span class="id" title="var">l2</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">StateWhile_liftStart_halt</span> (<span class="id" title="var">l1</span> : <span class="id" title="var">F1</span>) (<span class="id" title="var">l2</span> : <span class="id" title="var">F2</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">pM</span> <span class="id" title="var">l1</span>))) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">projT2</span> (<span class="id" title="var">pM</span> <span class="id" title="var">l1</span>) <span class="id" title="var">q</span> = <span class="id" title="var">inr</span> <span class="id" title="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">halt</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">StateWhile</span> <span class="id" title="var">pM</span> <span class="id" title="var">l1</span>)) (<span class="id" title="var">liftState</span> <span class="id" title="var">l1</span> <span class="id" title="var">q</span>) = <span class="id" title="var">halt</span> <span class="id" title="var">_</span> <span class="id" title="var">q</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">halt</span> <span class="id" title="tactic">at</span> 1, <span class="id" title="var">StateWhile</span>; <span class="id" title="var">cbn</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">StateWhile_halt</span>; <span class="id" title="var">cbn</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">andb_true_r</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">StateWhile_irrelevant'</span>.<br/>

<br/>
</div>

<div class="doc">
We need an injection from states of <span class="inlinecode"><span class="id" title="var">M</span></span> to states of <span class="inlinecode"><span class="id" title="var">M'</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="var">M2M_Retract</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">sigM</span> <span class="id" title="var">F</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">pM</span> : <span class="id" title="var">pTM</span> <span class="id" title="var">sigM</span> <span class="id" title="var">F</span> <span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">M</span> := (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">pM'</span> := (<span class="id" title="var">ToSingleTape</span> <span class="id" title="var">pM</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">M'</span> := (<span class="id" title="var">projT1</span> <span class="id" title="var">pM'</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ToSingleTape_Loop_inj</span> (<span class="id" title="var">q</span> <span class="id" title="var">q'</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>)) : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">Loop</span> <span class="id" title="var">q'</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">StateWhile.liftState</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l</span> := <span class="id" title="var">q</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">start</span>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ToSingleTape_inj</span> (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>)) : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ToSingleTape_Loop_inj</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">q</span>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ToSingleTape_Loop_graph</span> (<span class="id" title="var">q</span> <span class="id" title="var">q'</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">graph_of_TM</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">Loop</span> <span class="id" title="var">q</span>)) = <span class="id" title="var">graph_of_TM</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">Loop</span> <span class="id" title="var">q'</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">StateWhile_graph_irrelevant</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ToSingleTape_Loop_halt</span> (<span class="id" title="var">q1</span> <span class="id" title="var">q2</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>)) <span class="id" title="var">q</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">halt</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">Loop</span> <span class="id" title="var">q1</span>)) (<span class="id" title="var">ToSingleTape_Loop_inj</span> <span class="id" title="var">q</span> <span class="id" title="var">q1</span>) = <span class="id" title="var">halt</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">Loop</span> <span class="id" title="var">q2</span>)) (<span class="id" title="var">ToSingleTape_Loop_inj</span> <span class="id" title="var">q</span> <span class="id" title="var">q2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Loop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">ToSingleTape_Loop_inj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">StateWhile_halt_irrelevant</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">StateWhile_halt_irrelevant</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Wow,&nbsp;that&nbsp;was&nbsp;tricky&nbsp;to&nbsp;convince&nbsp;Coq&nbsp;that&nbsp;we&nbsp;can&nbsp;apply&nbsp;the&nbsp;lemma&nbsp;<span class="inlinecode"><span class="id" title="var">StateWhile_halt_irrelevant</span></span>...&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ToSingleTape_Loop_index</span> (<span class="id" title="var">q1</span> <span class="id" title="var">q2</span> <span class="id" title="var">q</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">index</span> (<span class="id" title="var">ToSingleTape_Loop_inj</span> <span class="id" title="var">q</span> <span class="id" title="var">q1</span>) = <span class="id" title="var">index</span> (<span class="id" title="var">ToSingleTape_Loop_inj</span> <span class="id" title="var">q</span> <span class="id" title="var">q2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">ToSingleTape_Loop_inj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;- <span class="id" title="var">StateWhile_index_irrelevant</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">StateWhile_index_irrelevant</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Unshelve</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;I&nbsp;am&nbsp;glad&nbsp;that&nbsp;(almost)&nbsp;the&nbsp;same&nbsp;trick&nbsp;worked&nbsp;here&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">M2M_Retract</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">MoreDominationLemmas</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">dominatedWith_add'</span> (<span class="id" title="var">c1</span> <span class="id" title="var">c2</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> &lt;=(<span class="id" title="var">c1</span>) <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span> &lt;=(<span class="id" title="var">c2</span>) <span class="id" title="var">D</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> + <span class="id" title="var">B</span> &lt;=(<span class="id" title="var">c1</span> + <span class="id" title="var">c2</span>) <span class="id" title="var">C</span> + <span class="id" title="var">D</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">dominatedWith</span>. <span class="id" title="var">nia</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">dominatedWith_S'''</span> (<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">S</span> <span class="id" title="var">a</span> &lt;=(<span class="id" title="var">c</span>) <span class="id" title="var">b</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> &lt;=(<span class="id" title="var">S</span> <span class="id" title="var">c</span>) <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">dominatedWith</span>. <span class="id" title="var">nia</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">dominatedWith_mult</span> (<span class="id" title="var">c1</span> <span class="id" title="var">c2</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> &lt;=(<span class="id" title="var">c1</span>) <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span> &lt;=(<span class="id" title="var">c2</span>) <span class="id" title="var">D</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> * <span class="id" title="var">B</span> &lt;=(<span class="id" title="var">c1</span> * <span class="id" title="var">c2</span>) <span class="id" title="var">C</span> * <span class="id" title="var">D</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">dominatedWith</span>. <span class="id" title="var">nia</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Corollary</span> <span class="id" title="var">dominatedWith_quad</span> (<span class="id" title="var">c1</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">A</span> <span class="id" title="var">C</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> &lt;=(<span class="id" title="var">c1</span>) <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> * <span class="id" title="var">A</span> &lt;=(<span class="id" title="var">c1</span> * <span class="id" title="var">c1</span>) <span class="id" title="var">C</span> * <span class="id" title="var">C</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Corollary</span> <span class="id" title="var">dominatedWith_mult3</span> (<span class="id" title="var">c1</span> <span class="id" title="var">c2</span> <span class="id" title="var">c3</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span> <span class="id" title="var">E</span> <span class="id" title="var">F</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> &lt;=(<span class="id" title="var">c1</span>) <span class="id" title="var">D</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span> &lt;=(<span class="id" title="var">c2</span>) <span class="id" title="var">E</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C</span> &lt;=(<span class="id" title="var">c3</span>) <span class="id" title="var">F</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> * <span class="id" title="var">B</span> * <span class="id" title="var">C</span> &lt;=(<span class="id" title="var">c1</span> * <span class="id" title="var">c2</span> * <span class="id" title="var">c3</span>) <span class="id" title="var">D</span> * <span class="id" title="var">E</span> * <span class="id" title="var">F</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Corollary</span> <span class="id" title="var">dominatedWith_cube</span> (<span class="id" title="var">c</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">A</span> <span class="id" title="var">D</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> &lt;=(<span class="id" title="var">c</span>) <span class="id" title="var">D</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">A</span> * <span class="id" title="var">A</span> * <span class="id" title="var">A</span> &lt;=(<span class="id" title="var">c</span> * <span class="id" title="var">c</span> * <span class="id" title="var">c</span>) <span class="id" title="var">D</span> * <span class="id" title="var">D</span> * <span class="id" title="var">D</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult3</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">MoreDominationLemmas</span>.<br/>

<br/>
<span class="id" title="keyword">Local</span> <span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">Encode_graph</span>.<br/>

<br/>
</div>

<div class="doc">
Single-tape and instantiated version of <span class="inlinecode"><span class="id" title="var">Univ</span></span>, <span class="inlinecode"><span class="id" title="var">U</span></span>. At this point, the input of <span class="inlinecode"><span class="id" title="var">U</span></span> is just an arbitrary single-tape machine <span class="inlinecode"><span class="id" title="var">M</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="var">U</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">sigM</span> : <span class="id" title="var">finType</span>). </div>

<div class="doc">
The alphabet of the simulated single-tape machine 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">F</span> : <span class="id" title="var">finType</span>). </div>

<div class="doc">
The label-type of the simulated single-tape machine 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> (<span class="id" title="var">inhSigM</span> : <span class="id" title="var">inhabitedC</span> <span class="id" title="var">sigM</span>). </div>

<div class="doc">
This is only a technical assumption. 
<div class="paragraph"> </div>

 Instantiate <span class="inlinecode"><span class="id" title="var">Univ</span></span> with its alphabet and retractions. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">sigUniv'</span> := <span class="id" title="var">FinType</span>(<span class="id" title="var">EqType</span>(<span class="id" title="var">sigList</span> (<span class="id" title="var">sigPair</span> (<span class="id" title="var">sigPair</span> (<span class="id" title="var">option</span> <span class="id" title="var">sigM</span>) <span class="id" title="var">sigState</span>) (<span class="id" title="var">sigPair</span> (<span class="id" title="var">option</span> (<span class="id" title="var">sigM</span>) * <span class="id" title="tactic">move</span>) <span class="id" title="var">sigState</span>)))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">sigUniv</span> : <span class="id" title="var">finType</span> :=  <span class="id" title="var">sigUniv'</span> ^+.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">retr_sigSimGraph_sigUniv</span> : <span class="id" title="var">Retract</span> (<span class="id" title="var">sigList</span> (<span class="id" title="var">sigPair</span> (<span class="id" title="var">sigPair</span> (<span class="id" title="var">option</span> <span class="id" title="var">sigM</span>) <span class="id" title="var">sigState</span>) (<span class="id" title="var">sigPair</span> (<span class="id" title="var">option</span> (<span class="id" title="var">sigM</span>) * <span class="id" title="tactic">move</span>) <span class="id" title="var">sigState</span>))) <span class="id" title="var">sigUniv'</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Retract_id</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">retr_sigSimGraph_sigUniv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span> : <span class="id" title="var">Retract</span> <span class="id" title="var">sigM</span> <span class="id" title="var">sigUniv'</span> := <span class="id" title="keyword">ltac</span>:(<span class="id" title="tactic">eauto</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Univ</span> : <span class="id" title="var">pTM</span> <span class="id" title="var">sigUniv</span> <span class="id" title="var">unit</span> 6 := @<span class="id" title="var">Univ</span> <span class="id" title="var">sigM</span> <span class="id" title="var">sigUniv'</span> <span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <span class="id" title="var">Univ</span> : <span class="id" title="var">pTM</span> <span class="id" title="var">sigUniv</span> <span class="id" title="var">unit</span> 6.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <span class="id" title="var">Univ</span> : <span class="id" title="var">pTM</span> <span class="id" title="var">sigUniv'</span>^+ <span class="id" title="var">unit</span> 6.<br/>

<br/>
</div>

<div class="doc">
The single-tape version of <span class="inlinecode"><span class="id" title="var">Univ</span></span> for alphabet <span class="inlinecode"><span class="id" title="var">sigM</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">U</span> := <span class="id" title="var">ToSingleTape</span> <span class="id" title="var">Univ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">sigU</span> := <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">U</span> <span class="id" title="keyword">with</span> <span class="id" title="var">pTM</span> ?<span class="id" title="var">sigU</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">exact</span> <span class="id" title="var">sigU</span> <span class="id" title="keyword">end</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <span class="id" title="var">U</span> : <span class="id" title="var">pTM</span> <span class="id" title="var">sigU</span> <span class="id" title="var">unit</span> 1.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*<br/>
&nbsp;&nbsp;<span class="comment">(**&nbsp;The&nbsp;simulated&nbsp;multi-tape&nbsp;machine&nbsp;over&nbsp;alphabet&nbsp;<span class="inlinecode"><span class="id" title="var">sigM</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;Variable&nbsp;(pM&nbsp;:&nbsp;pTM&nbsp;sigM&nbsp;F&nbsp;1).<br/>
&nbsp;&nbsp;Notation&nbsp;M&nbsp;:=&nbsp;(projT1&nbsp;pM).<br/>
&nbsp;&nbsp;&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
Encode <span class="inlinecode"><span class="id" title="var">pM</span></span> and the initial tape <span class="inlinecode"><span class="id" title="var">T</span></span> to a tape of <span class="inlinecode"><span class="id" title="var">U</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">initTapes_U</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) : <span class="id" title="var">tape</span> <span class="id" title="var">sigU</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tp</span> := <span class="id" title="var">T</span> <span class="id" title="tactic">in</span> <span class="comment">(*&nbsp;The&nbsp;tapes&nbsp;compressed&nbsp;into&nbsp;a&nbsp;single-tape&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">T_univ</span> := <span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">M</span> <span class="id" title="var">tp</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T_univ</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">contains_conf_U</span></span> is a predicate for <span class="inlinecode"><span class="id" title="var">U</span></span> that says that the tape <span class="inlinecode"><span class="id" title="var">t</span></span> "contains" the transition function for <span class="inlinecode"><span class="id" title="var">M</span></span> and the simulated tapes <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">tapes</span></span> <span class="inlinecode"><span class="id" title="var">sigM</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_Univ</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigUniv</span> 6) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsWorkingTape</span> <span class="id" title="var">_</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin0</span>] <span class="id" title="var">T</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsTrans</span> <span class="id" title="var">_</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin1</span>] <span class="id" title="var">M</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsState</span> <span class="id" title="var">_</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin2</span>] <span class="id" title="var">q</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> (<span class="id" title="var">i</span> : <span class="id" title="var">Fin.t</span> 3), <span class="id" title="var">isRight</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">FinR</span> 3 <span class="id" title="var">i</span>]).<br/>

<br/>
</div>

<div class="doc">
Variant with size. Note that <span class="inlinecode"><span class="id" title="var">s_Univ</span>[@<span class="id" title="var">Fin0</span>]</span> is irrelevant. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_Univ_size</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigUniv</span> 6) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsWorkingTape</span> <span class="id" title="var">_</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin0</span>] <span class="id" title="var">T</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsTrans_size</span> <span class="id" title="var">_</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin1</span>] <span class="id" title="var">M</span> <span class="id" title="var">s_Univ</span>[@<span class="id" title="var">Fin1</span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsState_size</span> <span class="id" title="var">_</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin2</span>] <span class="id" title="var">q</span> <span class="id" title="var">s_Univ</span>[@<span class="id" title="var">Fin2</span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> (<span class="id" title="var">i</span> : <span class="id" title="var">Fin.t</span> 3), <span class="id" title="var">isRight_size</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">FinR</span> 3 <span class="id" title="var">i</span>] <span class="id" title="var">s_Univ</span>[@<span class="id" title="var">FinR</span> 3 <span class="id" title="var">i</span>]).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">contains_conf_Univ_size_contains_conf_Univ</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigUniv</span> 6) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_Univ_size</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_Univ</span>      <span class="id" title="var">T_univ</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">H0</span>&amp;<span class="id" title="var">H1</span>&amp;<span class="id" title="var">H2</span>&amp;<span class="id" title="var">H3</span>). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">containsTrans_size_containsTrans</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">containsState_size_containsState</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">isRight_size_isRight</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_U'</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigU</span>) (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigUniv</span> 6) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_tapes</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> /\ <span class="id" title="var">contains_conf_Univ</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_U'_size</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigU</span>) (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigUniv</span> 6) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_tapes</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> /\ <span class="id" title="var">contains_conf_Univ_size</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_U</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigU</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigUniv</span> 6), <span class="id" title="var">contains_conf_U'</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_U_size</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigU</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigUniv</span> 6), <span class="id" title="var">contains_conf_U'_size</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">initTapes_U_correct</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_U</span> (<span class="id" title="var">initTapes_U</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span>) (<span class="id" title="var">start</span> <span class="id" title="var">M</span>) <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">contains_conf_U</span>, <span class="id" title="var">initTapes_U</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeSingleTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivTapes_correct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">initTapes_U_correct_size</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_U_size</span> (<span class="id" title="var">initTapes_U</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span>) (<span class="id" title="var">start</span> <span class="id" title="var">M</span>) <span class="id" title="var">T</span> (<span class="id" title="var">Vector.const</span> 0 <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">contains_conf_U</span>, <span class="id" title="var">initTapes_U</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeSingleTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivGraphTape_correct_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivStartStateTape_correct_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">destruct_fin</span> <span class="id" title="var">i</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">initRight_isRight_size</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Build correctness and termination relations for <span class="inlinecode"><span class="id" title="var">U</span></span> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">U_steps</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">T_Univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigUniv</span> 6) (<span class="id" title="var">q_M</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">k_M</span> : <span class="id" title="var">nat</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Loop_steps</span> (<span class="id" title="var">start</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">Univ</span>)) <span class="id" title="var">T_Univ</span> (<span class="id" title="var">Univ_steps</span> <span class="id" title="var">q_M</span> <span class="id" title="var">T</span> <span class="id" title="var">k_M</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">U_T</span> : <span class="id" title="var">tRel</span> <span class="id" title="var">sigU</span> 1 :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">tp</span> <span class="id" title="var">k</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">T_Univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigUniv</span> 6) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">q_M</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">c_M</span> : <span class="id" title="var">mconfig</span> <span class="id" title="var">sigM</span> (<span class="id" title="var">states</span> <span class="id" title="var">M</span>) 1) (<span class="id" title="var">k_M</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_U'</span> <span class="id" title="var">tp</span>[@<span class="id" title="var">Fin0</span>] <span class="id" title="var">T_Univ</span> <span class="id" title="var">q_M</span> <span class="id" title="var">T</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">loopM</span> <span class="id" title="var">_</span> (<span class="id" title="var">mk_mconfig</span> <span class="id" title="var">q_M</span> [|<span class="id" title="var">T</span>|]) <span class="id" title="var">k_M</span> = <span class="id" title="var">Some</span> <span class="id" title="var">c_M</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">U_steps</span> <span class="id" title="var">T_Univ</span> <span class="id" title="var">q_M</span> <span class="id" title="var">T</span> <span class="id" title="var">k_M</span> &lt;= <span class="id" title="var">k</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">U_terminatesIn</span> : <span class="id" title="var">projT1</span> <span class="id" title="var">U</span> ↓ <span class="id" title="var">U_T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">TerminatesIn_monotone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">U</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ToSingleTape_Terminates</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tp</span> <span class="id" title="var">k</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M</span>&amp;<span class="id" title="var">T_Univ</span>&amp;<span class="id" title="var">T</span>&amp;<span class="id" title="var">q_M</span>&amp;<span class="id" title="var">c_M</span>&amp;<span class="id" title="var">k_M</span>&amp;<span class="id" title="var">HCont</span>&amp;<span class="id" title="var">M_halt</span>&amp;<span class="id" title="var">Hk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">pM</span> := (<span class="id" title="var">M</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">tt</span>) : <span class="id" title="var">pTM</span> <span class="id" title="var">sigM</span> (<span class="id" title="var">FinType</span>(<span class="id" title="var">EqType</span> <span class="id" title="var">unit</span>)) 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HCont</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">HCont</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">HCont_Univ</span>&amp;<span class="id" title="var">HCont1</span>&amp;<span class="id" title="var">HCont2</span>&amp;<span class="id" title="var">HCont3</span>&amp;<span class="id" title="var">HCont4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c_M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M_finalState</span>&amp;<span class="id" title="var">M_finalTapes</span>). <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">vector_1_eta</span> <span class="id" title="var">M_finalTapes</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M_finalTape</span>&amp;-&gt;).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> @<span class="id" title="var">Univ_Terminates</span> <span class="id" title="var">sigM</span> <span class="id" title="var">sigUniv'</span> <span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Univ_term</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Univ_term</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">evar</span> (<span class="id" title="var">ktamtam</span> : <span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">Univ_term</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">tin</span> := <span class="id" title="var">T_Univ</span>) (<span class="id" title="var">k</span> := <span class="id" title="var">ktamtam</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_assert</span> <span class="id" title="var">Univ_term</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">Univ_finalConf</span>&amp;<span class="id" title="var">Univ_halt</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">ktamtam</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 5 <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">HCont1</span>. <span class="comment">(*&nbsp;working&nbsp;tape&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">containsTrans</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HCont2</span>|-*. <span class="comment">(*&nbsp;transition&nbsp;function&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">graph_of_TM</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">Loop</span> (<span class="id" title="var">q_M</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>))))) <span class="id" title="keyword">with</span> (<span class="id" title="var">graph_of_TM</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">ToSingleTape</span> <span class="id" title="var">pM</span>))); [ <span class="id" title="tactic">apply</span> <span class="id" title="var">HCont2</span> | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ToSingleTape_Loop_graph</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;state&nbsp;<span class="inlinecode"><span class="id" title="var">q_M</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clear_except</span> <span class="id" title="var">HCont3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">containsState</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HCont3</span>|-*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">ToSingleTape</span>, <span class="id" title="var">ToSingleTape_inj</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HCont3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">HCont3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">HCont4</span>. <span class="comment">(*&nbsp;internal&nbsp;tapes&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">M_halt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>. <span class="comment">(*&nbsp;instantiate&nbsp;<span class="inlinecode"><span class="id" title="var">ktamtam</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">T_Univ</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Univ_halt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">HCont_Univ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hk</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">ktamtam</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
First, we write a running time function that still depends on the original input tape <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">tape</span></span> <span class="inlinecode"><span class="id" title="var">sigM</span></span>. <span class="inlinecode"><span class="id" title="var">k</span></span> is the number of steps that <span class="inlinecode"><span class="id" title="var">M</span></span> needs on input <span class="inlinecode"><span class="id" title="var">T</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">fp</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> 1) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">k_Univ</span> := <span class="id" title="var">Univ_steps</span> (<span class="id" title="var">start</span> <span class="id" title="var">M</span>) <span class="id" title="var">T</span> <span class="id" title="var">k</span> <span class="id" title="tactic">in</span> <span class="comment">(*&nbsp;steps&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">Univ</span></span>&nbsp;needs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">T_Univ</span> := <span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span> <span class="id" title="tactic">in</span> <span class="comment">(*&nbsp;Tapes&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">Univ</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ToSingleTape_steps</span> <span class="id" title="var">Univ</span> <span class="id" title="var">T_Univ</span> <span class="id" title="var">k_Univ</span>. <span class="comment">(*&nbsp;Steps&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">U</span></span>&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*<br/>
&nbsp;&nbsp;Hypthesis&nbsp;(inhSigM&nbsp;:&nbsp;inhabitedC&nbsp;sigM).<br/>
&nbsp;&nbsp;<span class="comment">(**&nbsp;Because&nbsp;the&nbsp;asymtopic&nbsp;behaviour&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">fp</span></span>&nbsp;only&nbsp;depends&nbsp;on&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;tapes,&nbsp;we&nbsp;will&nbsp;just&nbsp;insert&nbsp;bogus&nbsp;tapes&nbsp;with&nbsp;the&nbsp;corresponding&nbsp;tapes&nbsp;size.&nbsp;*)</span><br/>
&nbsp;&nbsp;Definition&nbsp;f&nbsp;(M&nbsp;:&nbsp;mTM&nbsp;sigM&nbsp;1)&nbsp;:&nbsp;nat&nbsp;*&nbsp;nat&nbsp;-&gt;&nbsp;nat&nbsp;:=&nbsp;fun&nbsp;'(k,&nbsp;s)&nbsp;=&gt;&nbsp;fp&nbsp;M&nbsp;(bogus_tape&nbsp;s)&nbsp;k.<br/>
*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">U</span>) : <span class="id" title="var">mTM</span> <span class="id" title="var">sigU</span> 1.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <span class="id" title="keyword">forall</span> (<span class="id" title="var">tp</span> <span class="id" title="var">tp'</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigU</span>), <span class="id" title="var">terminates</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">U</span>) [|<span class="id" title="var">tp</span>|] 42 [|<span class="id" title="var">tp'</span>|].<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">fp</span></span> is literally only another definition for <span class="inlinecode"><span class="id" title="var">U_steps</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fp_eq</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">M</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) <span class="id" title="var">k</span>, <span class="id" title="var">fp</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> = <span class="id" title="var">U_steps</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span>) (<span class="id" title="var">start</span> <span class="id" title="var">M</span>) <span class="id" title="var">T</span> <span class="id" title="var">k</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Not the best approximation, but it's a beginning 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fp_nice1</span> <span class="id" title="var">M</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fp</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;=(<span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span>)) + 6 * <span class="id" title="var">Univ_steps</span> (<span class="id" title="var">start</span> <span class="id" title="var">M</span>) <span class="id" title="var">T</span> <span class="id" title="var">k</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> * <span class="id" title="var">x</span> * <span class="id" title="var">Univ_steps</span> (<span class="id" title="var">start</span> <span class="id" title="var">M</span>) <span class="id" title="var">T</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">fp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (@<span class="id" title="var">M2MBounds.Loop_steps_nice</span> <span class="id" title="var">sigUniv</span> (<span class="id" title="var">FinType</span>(<span class="id" title="var">EqType</span> <span class="id" title="var">unit</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Apply bounds for <span class="inlinecode"><span class="id" title="var">Univ_steps</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fp_nice2</span> <span class="id" title="var">M</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fp</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;=(<span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span>)) + <span class="id" title="var">size</span> <span class="id" title="var">k</span> * <span class="id" title="var">size</span> (<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">M</span>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> * <span class="id" title="var">x</span> * (<span class="id" title="var">size</span> <span class="id" title="var">k</span> * <span class="id" title="var">size</span> (<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">M</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (<span class="id" title="var">fp_nice1</span> <span class="id" title="var">M</span>)). <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_quad</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (<span class="id" title="var">UnivBounds.Univ_nice.Univ_steps_nice</span> <span class="id" title="var">sigM</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>. <span class="id" title="var">enough</span> (1 &lt;= <span class="id" title="var">size</span> (<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">M</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">nia</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">UnivBounds.Univ_nice.Encode_graph_hasSize_ge1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (<span class="id" title="var">UnivBounds.Univ_nice.Univ_steps_nice</span> <span class="id" title="var">sigM</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Throw away all constants that depend on <span class="inlinecode"><span class="id" title="var">M</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fp_nice3</span> <span class="id" title="var">M</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fp</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;=(<span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span>)) + <span class="id" title="var">size</span> <span class="id" title="var">k</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> * <span class="id" title="var">x</span> * <span class="id" title="var">size</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (<span class="id" title="var">fp_nice2</span> <span class="id" title="var">M</span>)). <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_quad</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeUnivWorkingTape_size</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">size</span> (<span class="id" title="var">makeUnivWorkingTape</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="var">T</span>) = <span class="id" title="var">size</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tape_hasSize</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">makeUnivWorkingTape</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">T</span>; <span class="id" title="var">cbn</span> -[<span class="id" title="var">sizeOfTape</span>]; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">progress</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">simpl_list</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeUnivWorkingTape_size'</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Encode_tape_size</span> (<span class="id" title="var">makeUnivWorkingTape</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="var">T</span>) = <span class="id" title="var">size</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Encode_tape_hasSize</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivWorkingTape_size</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tape_size_nice</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>), <span class="id" title="var">size</span> <span class="id" title="var">T</span> &lt;=(<span class="id" title="var">c</span>) <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T</span> + 1 }.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tape_hasSize</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">Encode_tape_size</span>. <span class="id" title="var">domWith_match</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_S'</span>; <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeUnivTapes_size_nice</span> <span class="id" title="var">M</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>), <span class="id" title="var">size</span> (<span class="id" title="var">makeUnivTapes</span> <span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span>) &lt;=(<span class="id" title="var">c</span>) <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T</span> + 1 }.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">makeUnivTapes</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize</span>. <span class="id" title="var">cbn</span> -[<span class="id" title="var">sizeOfTape</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.eq_le_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivWorkingTape_size'</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> <span class="id" title="var">tape_size_nice</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Simplify <span class="inlinecode"><span class="id" title="var">size</span></span> <span class="inlinecode">(<span class="id" title="var">vector_to_list</span></span> <span class="inlinecode">...)</span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fp_nice4</span> <span class="id" title="var">M</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fp</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;=(<span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T</span> + <span class="id" title="var">size</span> <span class="id" title="var">k</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> * <span class="id" title="var">x</span> * <span class="id" title="var">size</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (<span class="id" title="var">fp_nice3</span> <span class="id" title="var">M</span>)). <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_quad</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (<span class="id" title="var">makeUnivTapes_size_nice</span> <span class="id" title="var">M</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Encode_nat_hasSize</span>. <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Let's get rid of <span class="inlinecode"><span class="id" title="var">size</span></span> and <span class="inlinecode"><span class="id" title="keyword">let</span></span> and write it in one line 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fp_nice</span> <span class="id" title="var">M</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) <span class="id" title="var">k</span>, <span class="id" title="var">fp</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> &lt;=(<span class="id" title="var">c</span>) (<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T</span> + <span class="id" title="var">k</span> + 1) * (<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T</span> + <span class="id" title="var">k</span> + 1) * (<span class="id" title="var">k</span> + 1) }.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (<span class="id" title="var">fp_nice4</span> <span class="id" title="var">M</span>)). <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_quad</span>. <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_nat_hasSize</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_nat_hasSize</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Correctness 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO:&nbsp;Enrich&nbsp;relation&nbsp;with&nbsp;a&nbsp;size&nbsp;function&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">U_Rel</span> : <span class="id" title="var">pRel</span> <span class="id" title="var">sigU</span> <span class="id" title="var">unit</span> 1 :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">tin</span> '(<span class="id" title="var">_</span>, <span class="id" title="var">tout</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">pM</span> : <span class="id" title="var">pTM</span> <span class="id" title="var">sigM</span> <span class="id" title="var">F</span> 1) (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">q_M</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>)) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_U_size</span> <span class="id" title="var">tin</span>[@<span class="id" title="var">Fin0</span>] <span class="id" title="var">q_M</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">T'</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM</span>) (<span class="id" title="var">qout_M</span> : <span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>)) (<span class="id" title="var">k_M</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">loopM</span> <span class="id" title="var">_</span> (<span class="id" title="var">mk_mconfig</span> <span class="id" title="var">q_M</span> [|<span class="id" title="var">T</span>|]) <span class="id" title="var">k_M</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">mk_mconfig</span> <span class="id" title="var">qout_M</span> [|<span class="id" title="var">T'</span>|]) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_U_size</span> <span class="id" title="var">tout</span>[@<span class="id" title="var">Fin0</span>] <span class="id" title="var">qout_M</span> <span class="id" title="var">T'</span> (<span class="id" title="var">apply_sizeFun</span> (<span class="id" title="var">Univ_size</span> <span class="id" title="var">T</span> <span class="id" title="var">q_M</span> <span class="id" title="var">k_M</span>) <span class="id" title="var">s_Univ</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">U_Realises</span> : <span class="id" title="var">U</span> ⊨ <span class="id" title="var">U_Rel</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Realise_monotone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">U</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ToSingleTape_Realise</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tin</span> ([], <span class="id" title="var">tout</span>) <span class="id" title="var">HU</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HU</span>. <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pM</span> <span class="id" title="var">T</span> <span class="id" title="var">q_M</span> <span class="id" title="var">s_Univ</span> (<span class="id" title="var">T_Univ</span>&amp;<span class="id" title="var">H_U</span>&amp;(<span class="id" title="var">H_Conf1</span>&amp;<span class="id" title="var">HConf2</span>&amp;<span class="id" title="var">HConf3</span>&amp;<span class="id" title="var">HConf4</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HU</span>. <span class="id" title="tactic">specialize</span> <span class="id" title="var">HU</span> <span class="id" title="keyword">with</span> (1 := <span class="id" title="var">H_U</span>) <span class="id" title="keyword">as</span> (<span class="id" title="var">Univ_finalConf</span>&amp;<span class="id" title="var">k_Univ</span>&amp;<span class="id" title="var">Univ_term</span>&amp;<span class="id" title="var">Univ_resultCont</span>&amp;<span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">Univ_Realise</span> <span class="id" title="var">Univ_term</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Univ_correct</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Univ_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">Univ_correct</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">M</span> := <span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>) (<span class="id" title="var">tp</span> := <span class="id" title="var">T</span>) (<span class="id" title="var">q</span> := <span class="id" title="var">q_M</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">modpon</span> <span class="id" title="var">Univ_correct</span>. <span class="comment">(*&nbsp;This&nbsp;needs&nbsp;a&nbsp;bit&nbsp;help,&nbsp;because&nbsp;there&nbsp;are&nbsp;sizes&nbsp;involved&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">instantiate</span> (1 := [|<span class="id" title="var">_</span>;<span class="id" title="var">_</span>;<span class="id" title="var">_</span>|]). <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">specialize</span> (<span class="id" title="var">HConf4</span> <span class="id" title="var">i</span>); <span class="id" title="var">destruct_fin</span> <span class="id" title="var">i</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="var">isRight_mono</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Univ_correct</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Univ_correct</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">k_M</span>&amp;<span class="id" title="var">oconf_M</span>&amp;<span class="id" title="var">M_term</span>&amp;<span class="id" title="var">Univ_oconfCont1</span>&amp;<span class="id" title="var">Univ_oconfCont2</span>&amp;<span class="id" title="var">Univ_oconfCont3</span>&amp;<span class="id" title="var">Univ_oconfCont4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">oconf_M</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">qout_M</span> <span class="id" title="var">Ts'</span>]. <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">vector_1_eta</span> <span class="id" title="var">Ts'</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">T'</span>&amp;-&gt;).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">T'</span>, <span class="id" title="var">qout_M</span>, <span class="id" title="var">k_M</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">M_term</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">exists</span> (<span class="id" title="var">ctapes</span> <span class="id" title="var">Univ_finalConf</span>). <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Univ_resultCont</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>. <span class="comment">(*&nbsp;This&nbsp;needs&nbsp;a&nbsp;bit&nbsp;help&nbsp;again&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">Univ_oconfCont1</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">containsTrans</span>, <span class="id" title="var">containsTrans_size</span> <span class="id" title="tactic">in</span> *. <span class="id" title="var">contains_ext</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">containsState</span>, <span class="id" title="var">containsState_size</span> <span class="id" title="tactic">in</span> *. <span class="id" title="var">contains_ext</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Univ_oconfCont4</span> <span class="id" title="var">i</span>); <span class="id" title="var">destruct_fin</span> <span class="id" title="var">i</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="var">isRight_mono</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We only do space-analysis for <span class="inlinecode"><span class="id" title="var">Univ</span></span> now, because the size of the <span class="inlinecode"><span class="id" title="var">sigU</span></span> tapes is directly determined by the tapes of <span class="inlinecode"><span class="id" title="var">Univ</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <span class="id" title="var">UnivSpaceBounds.Univ_size_nice'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO:&nbsp;Maybe&nbsp;simplify&nbsp;this&nbsp;space&nbsp;bound&nbsp;a&nbsp;bit:&nbsp;every&nbsp;tape&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">Univ</span></span>,&nbsp;except&nbsp;the&nbsp;object&nbsp;tape,&nbsp;is&nbsp;bounded&nbsp;by&nbsp;a&nbsp;constant&nbsp;(that&nbsp;depends&nbsp;on&nbsp;M).&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">U</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">loopM_halt</span> (<span class="id" title="var">sigM</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">iconf</span> <span class="id" title="var">oconf</span> : <span class="id" title="var">mconfig</span> <span class="id" title="var">sigM</span> (<span class="id" title="var">states</span> <span class="id" title="var">M</span>) <span class="id" title="var">n</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">loopM</span> <span class="id" title="var">M</span> <span class="id" title="var">iconf</span> <span class="id" title="var">k</span> = <span class="id" title="var">Some</span> <span class="id" title="var">oconf</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">halt</span> <span class="id" title="var">M</span> (<span class="id" title="var">cstate</span> <span class="id" title="var">oconf</span>) = <span class="id" title="var">true</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">iconf</span>, <span class="id" title="var">oconf</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">loopM</span>, <span class="id" title="var">haltConf</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> % <span class="id" title="var">loop_fulfills</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">loopM_halt'</span> (<span class="id" title="var">sigM</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">iconf</span> : <span class="id" title="var">mconfig</span> <span class="id" title="var">sigM</span> (<span class="id" title="var">states</span> <span class="id" title="var">M</span>) <span class="id" title="var">n</span>) <span class="id" title="var">ostate</span> <span class="id" title="var">otapes</span> (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">loopM</span> <span class="id" title="var">M</span> <span class="id" title="var">iconf</span> <span class="id" title="var">k</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">mk_mconfig</span> <span class="id" title="var">ostate</span> <span class="id" title="var">otapes</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">halt</span> <span class="id" title="var">M</span> <span class="id" title="var">ostate</span> = <span class="id" title="var">true</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">loopM_halt</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Sum_bounded_by_max</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_sum_le_upperBound_times_length</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>) (<span class="id" title="var">y</span> : <span class="id" title="var">X</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span> &lt;= <span class="id" title="var">f</span> <span class="id" title="var">y</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">list_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span> &lt;= <span class="id" title="var">f</span> <span class="id" title="var">y</span> * <span class="id" title="var">length</span> <span class="id" title="var">xs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">x</span> <span class="id" title="var">xs</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">list_sum_shift</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>. <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_sum_le_max_times_length</span> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">list_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span> &lt;= <span class="id" title="var">max_list_map</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span> * <span class="id" title="var">length</span> <span class="id" title="var">xs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">enough</span> (<span class="id" title="var">xs</span> &lt;&gt; <span class="id" title="var">nil</span> -&gt; <span class="id" title="var">list_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span> &lt;= <span class="id" title="var">max_list_map</span> <span class="id" title="var">f</span> <span class="id" title="var">xs</span> * <span class="id" title="var">length</span> <span class="id" title="var">xs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">xs</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hnil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">max_list_map_In</span> <span class="id" title="var">f</span> <span class="id" title="var">Hnil</span>) <span class="id" title="keyword">as</span> (<span class="id" title="var">x</span>&amp;<span class="id" title="var">H</span>&amp;?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">list_sum_le_upperBound_times_length</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">xs</span> := <span class="id" title="var">xs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">max_list_map_ge</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Sum_bounded_by_max</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">MakeSingleTape_Bounded_by_sizeOfmTapes</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">sig</span> : <span class="id" title="var">finType</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>).<br/>

<br/>
</div>

<div class="doc">
We've already proven that <span class="inlinecode"><span class="id" title="var">sizeOfTape</span></span> <span class="inlinecode">(<span class="id" title="var">makeSingleTape</span></span> <span class="inlinecode"><span class="id" title="var">T</span>)</span> is the sum of the tape sizes (plus some constant) 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <span class="id" title="var">makeSingleTape_sizeOfTape</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tam</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sig</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">max_list_map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sig</span> =&gt; <span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">t</span> + 1) (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>) &lt;= <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + 3.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">max_list_map_lower_bound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Encode_tape_hasSize_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">add_le_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sizeOfmTapes_max_list_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">max_list_map_ge</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Encode_tapes_hasSize_le_sizeOfmTapes</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sig</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">size</span> <span class="id" title="var">T</span> &lt;= <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> * <span class="id" title="var">n</span> + <span class="id" title="var">n</span> * 3 + 2.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Encode_tapes_hasSize</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;- <span class="id" title="var">vector_to_list_sum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">list_sum_le_max_times_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">vector_to_list_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">add_le_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">tam</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tamtam</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sig</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">max_list_map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sig</span> =&gt; <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">tp</span> + 2) (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>) &lt;= <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + 2.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">max_list_map_lower_bound</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> ? <span class="comment">(**)</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">add_le_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sizeOfmTapes_max_list_map</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">max_list_map_ge</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeSingleTape_sizeOfmTapes</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sig</span> <span class="id" title="var">n</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sizeOfTape</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) &lt;= <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> * <span class="id" title="var">n</span> + <span class="id" title="var">n</span> * 3 + 3.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">makeSingleTape_sizeOfTape</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">vector_to_list_sum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">list_sum_le_max_times_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">vector_to_list_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">add_le_mono</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">tamtam</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ring_simplify</span>. <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">MakeSingleTape_Bounded_by_sizeOfmTapes</span>.<br/>

<br/>
<span class="comment">(*&nbsp;TODO&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
Now, we consider <span class="inlinecode"><span class="id" title="var">U</span></span> again, but we use <span class="inlinecode"><span class="id" title="var">ToSingleTape</span></span> as the "encoding" for a multi-tape machine <span class="inlinecode"><span class="id" title="var">M</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="var">UnivMultiTimeSpaceTheorem</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">sigM</span> : <span class="id" title="var">finType</span>). </div>

<div class="doc">
The alphabet of the simulated multi-tape machine 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>). </div>

<div class="doc">
The number of tapes of the simulated machine 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Hypothesis</span> (<span class="id" title="var">n_ge1</span> : 1 &lt;= <span class="id" title="var">n</span>). </div>

<div class="doc">
Another technical assumption 
<div class="paragraph"> </div>

 The alphabet for Multi-to-Mono compiled machine 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">sigM'</span> := (<span class="id" title="var">FinType</span>(<span class="id" title="var">EqType</span>(<span class="id" title="var">boundary</span> + <span class="id" title="var">sigList</span> (<span class="id" title="var">sigTape</span> <span class="id" title="var">sigM</span>)))).<br/>

<br/>
</div>

<div class="doc">
Instantiate <span class="inlinecode"><span class="id" title="var">Univ</span></span> and <span class="inlinecode"><span class="id" title="var">U</span></span> with the alphabet for <span class="inlinecode"><span class="id" title="var">M'</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">ToSingleTape</span></span> <span class="inlinecode"><span class="id" title="var">M</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">MUniv</span> := (<span class="id" title="var">Univ</span> <span class="id" title="var">sigM'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">sigMUniv</span> := (<span class="id" title="var">sigUniv</span> <span class="id" title="var">sigM'</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">sigMU</span> := (<span class="id" title="var">sigU</span> <span class="id" title="var">sigM'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MU</span> : <span class="id" title="var">pTM</span> <span class="id" title="var">sigMU</span> <span class="id" title="var">unit</span> 1 := <span class="id" title="var">U</span> <span class="id" title="var">sigM'</span>.<br/>

<br/>
</div>

<div class="doc">
The simulated multi-tape machine over alphabet <span class="inlinecode"><span class="id" title="var">sigM</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Variable</span> (<span class="id" title="var">M</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>).<br/>
</div>

<div class="doc">
We use the states of <span class="inlinecode"><span class="id" title="var">M</span></span> as labels for <span class="inlinecode"><span class="id" title="var">M</span></span>. When <span class="inlinecode"><span class="id" title="var">M'</span></span> terminated, we know exactly in which state <span class="inlinecode"><span class="id" title="var">M</span></span> terminated. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">pM</span> : <span class="id" title="var">pTM</span> <span class="id" title="var">sigM</span> (<span class="id" title="var">states</span> <span class="id" title="var">M</span>) <span class="id" title="var">n</span> := (<span class="id" title="var">M</span>; <span class="id" title="var">id</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">pM'</span> := (<span class="id" title="var">ToSingleTape</span> <span class="id" title="var">pM</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">M'</span> := (<span class="id" title="var">projT1</span> <span class="id" title="var">pM'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <span class="id" title="var">M'</span> : <span class="id" title="var">mTM</span> <span class="id" title="var">sigM'</span> 1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;'castState' q" := (<span class="id" title="var">q</span> : (<span class="id" title="var">states</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">pM</span>))) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 1).<br/>

<br/>
</div>

<div class="doc">
Encode <span class="inlinecode"><span class="id" title="var">ToSingleTape</span></span> <span class="inlinecode"><span class="id" title="var">M</span></span> and the initial tapes of <span class="inlinecode"><span class="id" title="var">t</span></span> to a tape of <span class="inlinecode"><span class="id" title="var">U</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">initTapes_MU</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">initTapes_U</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">ToSingleTape</span> <span class="id" title="var">pM</span>)) (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_MU'</span> (<span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span>) (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigMUniv</span> 6) (<span class="id" title="var">q_M'</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_tapes</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> /\ <span class="id" title="var">contains_conf_Univ</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M'</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_MU'_size</span> (<span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span>) (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigMUniv</span> 6) (<span class="id" title="var">q_M'</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_tapes</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> /\ <span class="id" title="var">contains_conf_Univ_size</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M'</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) <span class="id" title="var">s_Univ</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_MU</span> (<span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span>) (<span class="id" title="var">q_M'</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> (<span class="id" title="var">sigUniv</span> <span class="id" title="var">sigM'</span>) 6), <span class="id" title="var">contains_conf_MU'</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M'</span> <span class="id" title="var">T</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_MU_size</span> (<span class="id" title="var">t</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span>) (<span class="id" title="var">q_M'</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> (<span class="id" title="var">sigUniv</span> <span class="id" title="var">sigM'</span>) 6), <span class="id" title="var">contains_conf_MU'_size</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M'</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">contains_conf_MU'_size_contains_conf_MU'</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M'</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU'_size</span> <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M'</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU'</span>      <span class="id" title="var">t</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M'</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">H0</span>&amp;<span class="id" title="var">H1</span>). <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">contains_conf_Univ_size_contains_conf_Univ</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">contains_conf_MU_size_contains_conf_MU</span> <span class="id" title="var">t</span> <span class="id" title="var">q_M'</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU_size</span> <span class="id" title="var">t</span> <span class="id" title="var">q_M'</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU</span>      <span class="id" title="var">t</span> <span class="id" title="var">q_M'</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> (<span class="id" title="var">T_univ</span>&amp;<span class="id" title="var">H</span>). <span class="id" title="tactic">exists</span> <span class="id" title="var">T_univ</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">contains_conf_MU'_size_contains_conf_MU'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">initTapes_MU_correct</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>)  :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU</span> (<span class="id" title="var">initTapes_MU</span> <span class="id" title="var">T</span>) (<span class="id" title="var">start</span> <span class="id" title="var">M'</span>) <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">initTapes_U_correct</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">initTapes_MU_correct_size</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>)  :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU_size</span> (<span class="id" title="var">initTapes_MU</span> <span class="id" title="var">T</span>) (<span class="id" title="var">start</span> <span class="id" title="var">M'</span>) <span class="id" title="var">T</span> (<span class="id" title="var">Vector.const</span> 0 6).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">initTapes_U_correct_size</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Build correctness and termination relations for <span class="inlinecode"><span class="id" title="var">U</span></span> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MU_steps</span> (<span class="id" title="var">T_Univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigMUniv</span> 6) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k_M</span> : <span class="id" title="var">nat</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">U_steps</span> <span class="id" title="var">T_Univ</span> (<span class="id" title="var">start</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) (<span class="id" title="var">Loop_steps</span> (<span class="id" title="var">castState</span> (<span class="id" title="var">start</span> <span class="id" title="var">M</span>)) <span class="id" title="var">T</span> <span class="id" title="var">k_M</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MU_T</span> : <span class="id" title="var">tRel</span> <span class="id" title="var">sigMU</span> 1 :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">tp</span> <span class="id" title="var">k</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">T_Univ</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigMUniv</span> 6) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">c_M</span> : <span class="id" title="var">mconfig</span> <span class="id" title="var">sigM</span> (<span class="id" title="var">states</span> <span class="id" title="var">M</span>) <span class="id" title="var">n</span>) (<span class="id" title="var">k_M</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU'</span> <span class="id" title="var">tp</span>[@<span class="id" title="var">Fin0</span>] <span class="id" title="var">T_Univ</span> (<span class="id" title="var">start</span> <span class="id" title="var">M'</span>) <span class="id" title="var">T</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">loopM</span> <span class="id" title="var">_</span> (<span class="id" title="var">initc</span> <span class="id" title="var">M</span>  <span class="id" title="var">T</span>) <span class="id" title="var">k_M</span> = <span class="id" title="var">Some</span> <span class="id" title="var">c_M</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MU_steps</span> <span class="id" title="var">T_Univ</span> <span class="id" title="var">T</span> <span class="id" title="var">k_M</span> &lt;= <span class="id" title="var">k</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MU_terminatesIn</span> : <span class="id" title="var">projT1</span> <span class="id" title="var">MU</span> ↓ <span class="id" title="var">MU_T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">TerminatesIn_monotone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">MU</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">U_terminatesIn</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tp</span> <span class="id" title="var">k</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">T_Univ</span>&amp;<span class="id" title="var">T</span>&amp;<span class="id" title="var">c_M</span>&amp;<span class="id" title="var">k_M</span>&amp;<span class="id" title="var">HCont</span>&amp;<span class="id" title="var">M_halt</span>&amp;<span class="id" title="var">Hk</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HCont</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">HCont</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">HCont_Univ</span>&amp;<span class="id" title="var">HCont1</span>&amp;<span class="id" title="var">HCont2</span>&amp;<span class="id" title="var">HCont3</span>&amp;<span class="id" title="var">HCont4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c_M</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M_finalState</span>&amp;<span class="id" title="var">M_finalTapes</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">Loop_Terminates</span> (<span class="id" title="var">pM</span> := <span class="id" title="var">pM</span>) (<span class="id" title="var">q</span> := <span class="id" title="var">start</span> <span class="id" title="var">M</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">M'_term</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M'_term</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">ToSingleTape_T</span>, <span class="id" title="var">Loop_T</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M'_term</span>; <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M'_term</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">M'_term</span> ([|<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>|]) (<span class="id" title="var">Loop_steps</span> (<span class="id" title="var">castState</span> (<span class="id" title="var">start</span> <span class="id" title="var">M</span>)) <span class="id" title="var">T</span> <span class="id" title="var">k_M</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_assert</span> <span class="id" title="var">M'_term</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M'_finalConf</span>&amp;<span class="id" title="var">M'_halt</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">M'_finalConf</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M'_finalState</span>&amp;<span class="id" title="var">M'_finalTapes</span>). <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">vector_1_eta</span> <span class="id" title="var">M'_finalTapes</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M'_finalTape</span>&amp;-&gt;).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;change&nbsp;(eqType_X&nbsp;(type&nbsp;(states&nbsp;(projT1&nbsp;(Loop&nbsp;q_M)))))&nbsp;with&nbsp;(StateWhile_states&nbsp;(Step&nbsp;(pM:=pM)))&nbsp;in&nbsp;*.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">hnf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">projT1</span> (<span class="id" title="var">Loop</span> (<span class="id" title="var">castState</span> (<span class="id" title="var">start</span> <span class="id" title="var">M</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">T_Univ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">eexists</span> (<span class="id" title="var">mk_mconfig</span> <span class="id" title="var">_</span> [|<span class="id" title="var">_</span>|]). <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>. <span class="comment">(*&nbsp;transition&nbsp;function&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">clear_except</span> <span class="id" title="var">HCont3</span>. <span class="comment">(*&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">containsState</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HCont3</span>|-*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">ToSingleTape</span>, <span class="id" title="var">ToSingleTape_inj</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HCont3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">clear_except</span> <span class="id" title="var">M'_halt</span>. <span class="comment">(*&nbsp;Loop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">ToSingleTape</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">MU_steps</span>, <span class="id" title="var">ToSingleTape_inj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Instance&nbsp;sigM'_inhabited&nbsp;:&nbsp;inhabitedC&nbsp;sigM'.&nbsp;Proof.&nbsp;repeat&nbsp;econstructor.&nbsp;Qed.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Mfp</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">nat</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">fp</span> <span class="id" title="var">M'</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) (<span class="id" title="var">ToSingleTape_steps</span> <span class="id" title="var">pM</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Definition&nbsp;Mf&nbsp;:&nbsp;nat*nat-&gt;nat&nbsp;:=&nbsp;fun&nbsp;'(k,s)&nbsp;=&gt;&nbsp;Mfp&nbsp;(bogus_tapes&nbsp;_&nbsp;s)&nbsp;k.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Mfp_eq</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Mfp</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MU_steps</span> (<span class="id" title="var">makeUnivTapes</span> (<span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">_</span>) (<span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="var">_</span>) <span class="id" title="var">M'</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>)) <span class="id" title="var">T</span> <span class="id" title="var">k</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Instance of <span class="inlinecode"><span class="id" title="var">fp_nice</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Mfp_nice0</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigM'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>), <span class="id" title="var">fp</span> <span class="id" title="var">M'</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> &lt;=(<span class="id" title="var">c</span>) (<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T</span> + <span class="id" title="var">k</span> + 1) * (<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T</span> + <span class="id" title="var">k</span> + 1) * (<span class="id" title="var">k</span> + 1)}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">exact</span> (<span class="id" title="var">fp_nice</span> <span class="id" title="var">M'</span>). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
This is still a direct corollary from <span class="inlinecode"><span class="id" title="var">fp_nice</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Mfp_nice1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">T'</span> := <span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">k'</span> := <span class="id" title="var">ToSingleTape_steps</span> <span class="id" title="var">pM</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Mfp</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> &lt;=(<span class="id" title="var">c</span>) (<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T'</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T'</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">k'</span> + 1)}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (<span class="id" title="var">Mfp_nice0</span>)). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Simplify <span class="inlinecode"><span class="id" title="var">ToSingleTape_steps</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Mfp_nice2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">T'</span> := <span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">k'</span> := (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>) + <span class="id" title="var">n</span> * <span class="id" title="var">k</span>) * (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>) + <span class="id" title="var">n</span> * <span class="id" title="var">k</span>) * <span class="id" title="var">k</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Mfp</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> &lt;=(<span class="id" title="var">c</span>) (<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T'</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T'</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">k'</span> + 1)}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> <span class="id" title="var">Mfp_nice1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span> <span class="id" title="var">T'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>. <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (@<span class="id" title="var">M2MBounds.Loop_steps_nice</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">T'</span> <span class="id" title="var">k'</span>. <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span> <span class="id" title="var">T'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>. <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (@<span class="id" title="var">M2MBounds.Loop_steps_nice</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">T'</span> <span class="id" title="var">k'</span>. <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_add_r</span>; [ | <span class="id" title="var">nia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (@<span class="id" title="var">M2MBounds.Loop_steps_nice</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">k'</span>. <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Simplify <span class="inlinecode"><span class="id" title="var">sizeOfTape</span></span> <span class="inlinecode">(<span class="id" title="var">makeSingleTape</span></span> <span class="inlinecode"><span class="id" title="var">T</span>)</span> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Check</span> <span class="id" title="var">makeSingleTape_sizeOfmTapes</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Mfp_nice3</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">k'</span> := (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>) + <span class="id" title="var">n</span> * <span class="id" title="var">k</span>) * (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>) + <span class="id" title="var">n</span> * <span class="id" title="var">k</span>) * <span class="id" title="var">k</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Mfp</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> &lt;=(<span class="id" title="var">c</span>) (<span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">k'</span> + 1)}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> <span class="id" title="var">Mfp_nice2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">subst</span> <span class="id" title="var">k'</span>. <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">makeSingleTape_sizeOfmTapes</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">subst</span> <span class="id" title="var">k'</span>. <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">makeSingleTape_sizeOfmTapes</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">subst</span> <span class="id" title="var">k'</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Simplify <span class="inlinecode"><span class="id" title="var">size</span></span> <span class="inlinecode">(<span class="id" title="var">vector_to_list</span></span> <span class="inlinecode"><span class="id" title="var">T</span>)</span> and also remove <span class="inlinecode"><span class="id" title="var">n</span></span> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Mfp_nice</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">k'</span> := (<span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + <span class="id" title="var">k</span> + 1) * (<span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + <span class="id" title="var">k</span> + 1) * <span class="id" title="var">k</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Mfp</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> &lt;=(<span class="id" title="var">c</span>) (<span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">k'</span> + 1)}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> <span class="id" title="var">Mfp_nice3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">subst</span> <span class="id" title="var">k'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_add'</span>. 2: <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_refl</span>; <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_add'</span>. 1: <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_refl</span>; <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">change</span> (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>)) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> <span class="id" title="var">T</span>). <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize_le_sizeOfmTapes</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">change</span> (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>)) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> <span class="id" title="var">T</span>). <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize_le_sizeOfmTapes</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">subst</span> <span class="id" title="var">k'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_add'</span>. 2: <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_refl</span>; <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_add'</span>. 1: <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_refl</span>; <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">change</span> (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>)) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> <span class="id" title="var">T</span>). <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize_le_sizeOfmTapes</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">change</span> (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>)) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> <span class="id" title="var">T</span>). <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize_le_sizeOfmTapes</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">subst</span> <span class="id" title="var">k'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_add'</span>. 2: <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_refl</span>; <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_mult3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">change</span> (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>)) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> <span class="id" title="var">T</span>). <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize_le_sizeOfmTapes</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">change</span> (<span class="id" title="var">size</span> (<span class="id" title="var">vector_to_list</span> <span class="id" title="var">T</span>)) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> <span class="id" title="var">T</span>). <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">Encode_tapes_hasSize_le_sizeOfmTapes</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*<br/>
&nbsp;&nbsp;<span class="comment">(**&nbsp;Finally,&nbsp;consider&nbsp;<span class="inlinecode"><span class="id" title="var">Mf</span></span>&nbsp;and&nbsp;replace&nbsp;<span class="inlinecode"><span class="id" title="var">sizeOfmTapes</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span>&nbsp;with&nbsp;<span class="inlinecode"><span class="id" title="var">s</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;Lemma&nbsp;Mf_nice&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{c&nbsp;:&nbsp;nat&nbsp;|&nbsp;forall&nbsp;k&nbsp;s,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;k'&nbsp;:=&nbsp;(s&nbsp;+&nbsp;k&nbsp;+&nbsp;1)&nbsp;*&nbsp;(s&nbsp;+&nbsp;k&nbsp;+&nbsp;1)&nbsp;*&nbsp;k&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mf&nbsp;(k,&nbsp;s)&nbsp;&lt;=(c)&nbsp;(s&nbsp;+&nbsp;k'&nbsp;+&nbsp;1)&nbsp;*&nbsp;(s&nbsp;+&nbsp;k'&nbsp;+&nbsp;1)&nbsp;*&nbsp;(k'&nbsp;+&nbsp;1)}.<br/>
&nbsp;&nbsp;Proof.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;eexists.&nbsp;intros.&nbsp;cbn.&nbsp;eapply&nbsp;dominatedWith_trans.&nbsp;apply&nbsp;(proj2_sig&nbsp;Mfp_nice).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;dominatedWith_mult3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;subst&nbsp;k'.&nbsp;apply&nbsp;dominatedWith_add'.&nbsp;2:&nbsp;apply&nbsp;dominatedWith_refl;&nbsp;constructor.&nbsp;apply&nbsp;dominatedWith_add'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;setoid_rewrite&nbsp;bogus_tapes_sizeOfmTapes.&nbsp;apply&nbsp;dominatedWith_solve.&nbsp;nia.&nbsp;nia.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;setoid_rewrite&nbsp;bogus_tapes_sizeOfmTapes.&nbsp;apply&nbsp;dominatedWith_solve.&nbsp;nia.&nbsp;nia.&nbsp;nia.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;subst&nbsp;k'.&nbsp;apply&nbsp;dominatedWith_add'.&nbsp;2:&nbsp;apply&nbsp;dominatedWith_refl;&nbsp;constructor.&nbsp;apply&nbsp;dominatedWith_add'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;setoid_rewrite&nbsp;bogus_tapes_sizeOfmTapes.&nbsp;apply&nbsp;dominatedWith_solve.&nbsp;nia.&nbsp;nia.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;setoid_rewrite&nbsp;bogus_tapes_sizeOfmTapes.&nbsp;apply&nbsp;dominatedWith_solve.&nbsp;nia.&nbsp;nia.&nbsp;nia.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;subst&nbsp;k'.&nbsp;apply&nbsp;dominatedWith_add'.&nbsp;2:&nbsp;apply&nbsp;dominatedWith_refl;&nbsp;constructor.&nbsp;apply&nbsp;dominatedWith_mult3.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;domWith_approx.&nbsp;setoid_rewrite&nbsp;bogus_tapes_sizeOfmTapes.&nbsp;apply&nbsp;dominatedWith_solve.&nbsp;nia.&nbsp;nia.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;domWith_approx.&nbsp;setoid_rewrite&nbsp;bogus_tapes_sizeOfmTapes.&nbsp;apply&nbsp;dominatedWith_solve.&nbsp;nia.&nbsp;nia.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;domWith_approx.<br/>
&nbsp;&nbsp;Qed.<br/>
&nbsp;&nbsp;&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
Extract the nice polynominal 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Mf</span> : <span class="id" title="var">nat</span>*<span class="id" title="var">nat</span>-&gt;<span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> '(<span class="id" title="var">k</span>, <span class="id" title="var">s</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">c</span> := <span class="id" title="var">proj1_sig</span> <span class="id" title="var">Mfp_nice</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">k'</span> := (<span class="id" title="var">s</span> + <span class="id" title="var">k</span> + 1) * (<span class="id" title="var">s</span> + <span class="id" title="var">k</span> + 1) * <span class="id" title="var">k</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> * ((<span class="id" title="var">s</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">s</span> + <span class="id" title="var">k'</span> + 1) * (<span class="id" title="var">k'</span> + 1)).<br/>

<br/>
</div>

<div class="doc">
We need this final bound in the End Theorem 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Mf_bounded</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span>, <span class="id" title="var">Mfp</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> &lt;= <span class="id" title="var">Mf</span> (<span class="id" title="var">k</span>, <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">Mf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">s</span> := <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">c</span> := <span class="id" title="var">proj1_sig</span> <span class="id" title="var">Mfp_nice</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">k'</span> := (<span class="id" title="var">s</span> + <span class="id" title="var">k</span> + 1) * (<span class="id" title="var">s</span> + <span class="id" title="var">k</span> + 1) * <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> <span class="id" title="var">Mfp_nice</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Correctness 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MU_size</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k_M'</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">Vector.t</span> (<span class="id" title="var">nat</span>-&gt;<span class="id" title="var">nat</span>) 6 := <span class="id" title="var">Univ_size</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) (<span class="id" title="var">start</span> <span class="id" title="var">M'</span>) <span class="id" title="var">k_M'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">MU_Rel</span> : <span class="id" title="var">pRel</span> <span class="id" title="var">sigMU</span> <span class="id" title="var">unit</span> 1 :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">tin</span> '(<span class="id" title="var">_</span>, <span class="id" title="var">tout</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU_size</span> <span class="id" title="var">tin</span>[@<span class="id" title="var">Fin0</span>] (<span class="id" title="var">start</span> <span class="id" title="var">M'</span>) <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">T'</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">qout_M</span> : <span class="id" title="var">states</span> <span class="id" title="var">M</span>) (<span class="id" title="var">qout_M'</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">k_M</span> <span class="id" title="var">k_M'</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">loopM</span> <span class="id" title="var">_</span> (<span class="id" title="var">initc</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span>) <span class="id" title="var">k_M</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">mk_mconfig</span> <span class="id" title="var">qout_M</span> <span class="id" title="var">T'</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">loopM</span> <span class="id" title="var">_</span> (<span class="id" title="var">initc</span> <span class="id" title="var">M'</span> [|<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>|]) <span class="id" title="var">k_M'</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">mk_mconfig</span> <span class="id" title="var">qout_M'</span> [|<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T'</span>|]) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU_size</span> <span class="id" title="var">tout</span>[@<span class="id" title="var">Fin0</span>] <span class="id" title="var">qout_M'</span> <span class="id" title="var">T'</span> (<span class="id" title="var">apply_sizeFun</span> (<span class="id" title="var">MU_size</span> <span class="id" title="var">T</span> <span class="id" title="var">k_M'</span>) <span class="id" title="var">s_Univ</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">projT2</span> <span class="id" title="var">pM'</span> <span class="id" title="var">qout_M'</span> = <span class="id" title="var">qout_M</span>. </div>

<div class="doc">
We can show that the final state of <span class="inlinecode"><span class="id" title="var">M'</span></span> corresponds to the final state of <span class="inlinecode"><span class="id" title="var">M</span></span>. However, <span class="inlinecode"><span class="id" title="var">qout_M'</span></span> <span class="inlinecode">&lt;&gt;</span> <span class="inlinecode"><span class="id" title="var">ToSingleTape_inj</span></span> <span class="inlinecode"><span class="id" title="var">qout_M</span></span>. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MU_Realises</span> : <span class="id" title="var">MU</span> ⊨ <span class="id" title="var">MU_Rel</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Realise_monotone</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">MU</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">U_Realises</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tin</span> ([], <span class="id" title="var">tout</span>) <span class="id" title="var">HU</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HU</span>. <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span> <span class="id" title="var">HUniv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">contains_conf_U_size</span> <span class="id" title="tactic">at</span> 1, <span class="id" title="var">contains_conf_U'_size</span> <span class="id" title="tactic">at</span> 1 <span class="id" title="tactic">in</span> <span class="id" title="var">HU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HUniv</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">T_Univ</span>&amp;<span class="id" title="var">H_contUnic</span>&amp;<span class="id" title="var">HCont1</span>&amp;<span class="id" title="var">HCont2</span>&amp;<span class="id" title="var">HCont3</span>&amp;<span class="id" title="var">HCont4</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">HU</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">pM</span> := <span class="id" title="var">pM'</span>) (<span class="id" title="var">T</span> := <span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>) (<span class="id" title="var">q_M</span> := <span class="id" title="var">start</span> <span class="id" title="var">_</span>) (<span class="id" title="var">s_Univ</span> := <span class="id" title="var">s_Univ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_assert</span> <span class="id" title="var">HU</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M'_finalTapes</span>&amp;<span class="id" title="var">M'_finalState</span>&amp;<span class="id" title="var">U_k</span>&amp;<span class="id" title="var">M'_halt</span>&amp;<span class="id" title="var">M'_finalContains</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">Loop_Realise</span> (<span class="id" title="var">pM</span> := <span class="id" title="var">pM</span>) (<span class="id" title="var">q</span> := <span class="id" title="var">start</span> <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">M'_real</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M'_real</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">ToSingleTape_T</span>, <span class="id" title="var">Loop_T</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M'_real</span>; <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M'_real</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">evar</span> (<span class="id" title="var">M'_outc'</span> : <span class="id" title="var">mconfig</span> (<span class="id" title="var">sigList</span> (<span class="id" title="var">sigTape</span> (<span class="id" title="var">eqType_X</span> (<span class="id" title="keyword">type</span> <span class="id" title="var">sigM</span>)))) ^+ (<span class="id" title="var">states</span> <span class="id" title="var">M'</span>) 1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">M'_real</span> ([|<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>|]) <span class="id" title="var">U_k</span> <span class="id" title="var">M'_outc'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_assert</span> <span class="id" title="var">M'_real</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">M'_outc'</span>. <span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="var">mk_mconfig</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">M'_outc'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M'_real</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M'_real</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">M'_real</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">T0</span> := <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_assert</span> <span class="id" title="var">M'_real</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M_finalConf</span>&amp;<span class="id" title="var">M_k</span>&amp;<span class="id" title="var">M_halts</span>&amp;<span class="id" title="var">M_finalContained</span>&amp;<span class="id" title="var">tam</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">makeSingleTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">M_finalConf</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">M_finalState</span>&amp;<span class="id" title="var">M_finalTapes</span>). <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M'_finalContains</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">tam</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">M'_finalContains</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">T_Univ_final</span>&amp;?). <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H2</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>, <span class="id" title="var">H0</span>, <span class="id" title="var">H1</span>, <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span> ]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">initc</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">M'_halt</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">proj1</span> (@<span class="id" title="var">contains_tapes_iff</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">M_finalContained</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">contains_tapes</span> <span class="id" title="tactic">in</span> <span class="id" title="var">M_finalContained</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">containsWorkingTape</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">containsWorkingTape</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">containsState</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>|-*. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Complement lemma to <span class="inlinecode"><span class="id" title="var">tape_size_nice</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tape_sizeOfTape_nice</span> (<span class="id" title="var">sig</span> : <span class="id" title="var">finType</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sig</span>), <span class="id" title="var">sizeOfTape</span> <span class="id" title="var">T</span> &lt;=(<span class="id" title="var">c</span>) <span class="id" title="var">size</span> <span class="id" title="var">T</span> }.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">y</span> := <span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">Encode_tape_size</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">T</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">repeat</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">simpl_list</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>: <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>; <span class="id" title="tactic">omega</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_solve</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.eq_le_incl</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Encode_tape_hasSize</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">makeUnivWorkingTape_sizeOfTape_nice</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>), <span class="id" title="var">sizeOfTape</span> (<span class="id" title="var">makeUnivWorkingTape</span> (<span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="var">sigM'</span>) (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>)) &lt;=(<span class="id" title="var">c</span>) <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + 1 }.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (@<span class="id" title="var">tape_sizeOfTape_nice</span> <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">makeUnivWorkingTape_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">proj2_sig</span> (@<span class="id" title="var">tape_size_nice</span> <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">dominatedWith_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">makeSingleTape_sizeOfmTapes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">domWith_approx</span>. <span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + 1). <span class="id" title="var">all</span>: <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Print</span> <span class="id" title="var">UnivSpaceBounds.Univ_size_bound</span>.<br/>

<br/>
</div>

<div class="doc">
We need to bound the size of the <span class="inlinecode"><span class="id" title="var">sigMU</span></span> tape 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">containsTrans_size_hasSize</span> <span class="id" title="var">tp</span> <span class="id" title="var">s</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsTrans_size</span> (<span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">sigM'</span>) <span class="id" title="var">tp</span> <span class="id" title="var">M'</span> <span class="id" title="var">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp</span> &lt;= <span class="id" title="var">s</span> + <span class="id" title="var">size</span> (<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">M'</span>) + 4.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">ls</span>&amp;-&gt;&amp;<span class="id" title="var">Hs</span>). <span class="id" title="tactic">repeat</span> (<span class="id" title="var">cbn</span> -[<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">encode</span>]; <span class="id" title="var">simpl_list</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eenough</span> ((| <span class="id" title="var">ls</span> |) + <span class="id" title="var">S</span> ((| <span class="id" title="var">encode</span> (<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">M'</span>) |) + 1) + 2 &lt;= <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>. <span class="comment">(*&nbsp;magic&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">cbn</span> -[<span class="id" title="var">graph_of_TM</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>|-*. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_length</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> (| <span class="id" title="var">encode</span> (<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">M'</span>) |) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> (<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">M'</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ring_simplify</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">containsState_size_hasSize</span> <span class="id" title="var">tp</span> <span class="id" title="var">s</span> (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">containsState_size</span> (<span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">sigM'</span>) <span class="id" title="var">tp</span> <span class="id" title="var">q</span> <span class="id" title="var">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp</span> &lt;= <span class="id" title="var">index</span> <span class="id" title="var">q</span> + <span class="id" title="var">s</span> + 6.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">ls</span>&amp;-&gt;&amp;<span class="id" title="var">Hs</span>). <span class="id" title="tactic">repeat</span> (<span class="id" title="var">cbn</span> -[<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">encode</span>]; <span class="id" title="var">simpl_list</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">progress</span> <span class="id" title="var">eenough</span> ((| <span class="id" title="var">ls</span> |) + <span class="id" title="var">S</span> ((| <span class="id" title="var">encode</span> (<span class="id" title="var">halt</span> <span class="id" title="var">M'</span> <span class="id" title="var">q</span>, <span class="id" title="var">index</span> <span class="id" title="var">q</span>) |) + 1) + 2 &lt;= <span class="id" title="var">_</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>. <span class="comment">(*&nbsp;magic&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">cbn</span> -[<span class="id" title="var">graph_of_TM</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>|-*. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_length</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> (| <span class="id" title="var">encode</span> (<span class="id" title="var">halt</span> <span class="id" title="var">M'</span> <span class="id" title="var">q</span>, <span class="id" title="var">index</span> <span class="id" title="var">q</span>) |) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> (<span class="id" title="var">halt</span> <span class="id" title="var">M'</span> <span class="id" title="var">q</span>, <span class="id" title="var">index</span> <span class="id" title="var">q</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">UnivSpaceBounds.Encode_state_hasSize</span>. <span class="id" title="var">ring_simplify</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hs</span>. <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The exact size of the <span class="inlinecode"><span class="id" title="var">sigMU</span></span> tape, given the configuration and the rest sizes of <span class="inlinecode"><span class="id" title="var">Univ</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contains_conf_MU_size_exact_size</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">T_univ</span> : <span class="id" title="var">tapes</span> (<span class="id" title="var">sigUniv</span> <span class="id" title="var">sigM'</span>) 6) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">s0</span> := <span class="id" title="var">s_Univ</span>[@<span class="id" title="var">Fin0</span>] <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">s1</span> := <span class="id" title="var">s_Univ</span>[@<span class="id" title="var">Fin1</span>] <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">s2</span> := <span class="id" title="var">s_Univ</span>[@<span class="id" title="var">Fin2</span>] <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">s3</span> := <span class="id" title="var">s_Univ</span>[@<span class="id" title="var">Fin3</span>] <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">s4</span> := <span class="id" title="var">s_Univ</span>[@<span class="id" title="var">Fin4</span>] <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">s5</span> := <span class="id" title="var">s_Univ</span>[@<span class="id" title="var">Fin5</span>] <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">vector_sum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> (<span class="id" title="var">eqType_X</span> (<span class="id" title="keyword">type</span> <span class="id" title="var">sigM</span>)) =&gt; <span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp</span> + 1) <span class="id" title="var">T</span> + <span class="id" title="var">s1</span> + <span class="id" title="var">size</span> (<span class="id" title="var">graph_of_TM</span> <span class="id" title="var">M'</span>) + <span class="id" title="var">index</span> <span class="id" title="var">q</span> + <span class="id" title="var">s2</span> + <span class="id" title="var">s3</span> + <span class="id" title="var">s4</span> + <span class="id" title="var">s5</span> + 33.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">contains_conf_MU_size_eq</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span>) <span class="id" title="var">T_univ</span> (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU'_size</span> <span class="id" title="var">tp</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">tp</span> &lt;= <span class="id" title="var">contains_conf_MU_size_exact_size</span> <span class="id" title="var">T</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q</span> <span class="id" title="var">s_Univ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tp</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span> <span class="id" title="var">s_Univ</span>. <span class="id" title="tactic">intros</span> (<span class="id" title="var">H_univ</span>&amp;<span class="id" title="var">HT0</span>&amp;<span class="id" title="var">HT1</span>&amp;<span class="id" title="var">HT2</span>&amp;<span class="id" title="var">HT3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">proj1</span> (@<span class="id" title="var">contains_tapes_iff</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H_univ</span> <span class="id" title="keyword">as</span> -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Destruct&nbsp;and&nbsp;name&nbsp;the&nbsp;tapes&nbsp;and&nbsp;size&nbsp;vector&nbsp;entries&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lock</span> <span class="id" title="var">s_Univ</span>. <span class="id" title="var">destruct_tapes</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">h</span> <span class="id" title="var">into</span> <span class="id" title="var">t0</span>, <span class="id" title="var">h0</span> <span class="id" title="var">into</span> <span class="id" title="var">t1</span>, <span class="id" title="var">h1</span> <span class="id" title="var">into</span> <span class="id" title="var">t2</span>, <span class="id" title="var">h2</span> <span class="id" title="var">into</span> <span class="id" title="var">t3</span>, <span class="id" title="var">h3</span> <span class="id" title="var">into</span> <span class="id" title="var">t4</span>, <span class="id" title="var">h4</span> <span class="id" title="var">into</span> <span class="id" title="var">t5</span>. <span class="id" title="var">unlock</span> <span class="id" title="var">s_Univ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_vector</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">h</span> <span class="id" title="var">into</span> <span class="id" title="var">s0</span>, <span class="id" title="var">h0</span> <span class="id" title="var">into</span> <span class="id" title="var">s1</span>, <span class="id" title="var">h1</span> <span class="id" title="var">into</span> <span class="id" title="var">s2</span>, <span class="id" title="var">h2</span> <span class="id" title="var">into</span> <span class="id" title="var">s3</span>, <span class="id" title="var">h3</span> <span class="id" title="var">into</span> <span class="id" title="var">s4</span>, <span class="id" title="var">h4</span> <span class="id" title="var">into</span> <span class="id" title="var">s5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> -[<span class="id" title="var">sizeOfTape</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">HT1</span>,<span class="id" title="var">HT2</span>,<span class="id" title="var">HT3</span>,<span class="id" title="var">HT0</span>|-*.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">proj1</span> (@<span class="id" title="var">containsWorkingTape_iff</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">HT0</span> <span class="id" title="keyword">as</span> -&gt;.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">makeSingleTape_sizeOfTape'</span>. <span class="id" title="var">cbn</span> -[<span class="id" title="var">makeUnivWorkingTape</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">makeUnivWorkingTape_size'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">makeSingleTape_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> (<span class="id" title="var">containsTrans_size_hasSize</span> <span class="id" title="var">HT1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> (<span class="id" title="var">containsState_size_hasSize</span> <span class="id" title="var">HT2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">HT3</span> <span class="id" title="var">Fin1</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">HT4</span>. <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">HT3</span> <span class="id" title="var">Fin2</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">HT5</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">HT3</span> <span class="id" title="var">Fin0</span>). <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">HT3</span>,<span class="id" title="var">HT4</span>,<span class="id" title="var">HT5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">isRight_size_hasSize</span> <span class="id" title="var">HT3</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">isRight_size_hasSize</span> <span class="id" title="var">HT4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">isRight_size_hasSize</span> <span class="id" title="var">HT5</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">contains_conf_MU_size_exact_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> [<span class="id" title="var">Vector.nth</span> <span class="id" title="var">Vector.caseS</span>]. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">contains_conf_MU_size0_nice</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">c</span> : <span class="id" title="var">nat</span> | <span class="id" title="keyword">forall</span> (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU_size</span> <span class="id" title="var">tp</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span> (<span class="id" title="var">Vector.const</span> 0 6) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">tp</span> &lt;=(<span class="id" title="var">c</span>) <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + 1 }.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">tp</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span>. <span class="id" title="tactic">intros</span> (<span class="id" title="var">T_Univ</span>&amp;<span class="id" title="var">Univ_contains</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">contains_conf_MU_size_eq</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">contains_conf_MU_size_exact_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">dominatedWith_S'''</span>. <span class="id" title="var">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">vector_sum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">tp0</span> : <span class="id" title="var">tape</span> (<span class="id" title="var">eqType_X</span> (<span class="id" title="keyword">type</span> <span class="id" title="var">sigM</span>)) =&gt; <span class="id" title="var">Encode_tape_size</span> <span class="id" title="var">tp0</span> + 1) <span class="id" title="var">T</span> + 1) <span class="id" title="keyword">with</span> (<span class="id" title="var">size</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:{ <span class="id" title="tactic">apply</span> <span class="id" title="var">Encode_tapes_hasSize</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Encode_tapes_hasSize_le_sizeOfmTapes</span>. <span class="id" title="var">domWith_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">instantiate</span> (1 := <span class="id" title="var">UnivBounds.Univ_nice.number_of_states</span> <span class="id" title="var">M'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">hnf</span>. <span class="id" title="var">ring_simplify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">enough</span> (<span class="id" title="var">index</span> <span class="id" title="var">q</span> &lt;= <span class="id" title="var">UnivBounds.Univ_nice.number_of_states</span> <span class="id" title="var">M'</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">UnivSpaceBounds.state_index_le</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
This is our final constant for space usage 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">space_constant</span> := <span class="id" title="var">proj1_sig</span> <span class="id" title="var">contains_conf_MU_size0_nice</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">space_constant_correct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">tp</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU_size</span> <span class="id" title="var">tp</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span> (<span class="id" title="var">Vector.const</span> 0 6) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">tp</span> &lt;= <span class="id" title="var">space_constant</span> * (<span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + 1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">exact</span> (<span class="id" title="var">proj2_sig</span> <span class="id" title="var">contains_conf_MU_size0_nice</span> <span class="id" title="var">tp</span> <span class="id" title="var">q</span> <span class="id" title="var">T</span> <span class="id" title="var">H</span>). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">contains_conf_MU'_contains_conf_MU'_size</span> <span class="id" title="var">tp</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M</span> <span class="id" title="var">T</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU'</span>      <span class="id" title="var">tp</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M</span> <span class="id" title="var">T</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU'_size</span> <span class="id" title="var">tp</span> <span class="id" title="var">T_univ</span> <span class="id" title="var">q_M</span> <span class="id" title="var">T</span> [| |<span class="id" title="tactic">left</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin0</span>]|; |<span class="id" title="tactic">left</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin1</span>]|; |<span class="id" title="tactic">left</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin2</span>]|; |<span class="id" title="var">tape_local_l</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin3</span>]|; |<span class="id" title="var">tape_local_l</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin4</span>]|; |<span class="id" title="var">tape_local_l</span> <span class="id" title="var">T_univ</span>[@<span class="id" title="var">Fin5</span>]| |].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">H0</span>&amp;<span class="id" title="var">H1</span>&amp;<span class="id" title="var">H2</span>&amp;<span class="id" title="var">H3</span>&amp;<span class="id" title="var">H4</span>). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">containsTrans_size</span>, <span class="id" title="var">containsTrans</span> <span class="id" title="tactic">in</span> *. <span class="id" title="var">simpl_vector</span>. <span class="id" title="var">contains_ext</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">containsState_size</span>, <span class="id" title="var">containsState</span> <span class="id" title="tactic">in</span> *. <span class="id" title="var">simpl_vector</span>. <span class="id" title="var">contains_ext</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H4</span> <span class="id" title="var">i</span>); <span class="id" title="var">destruct_fin</span> <span class="id" title="var">i</span>; <span class="id" title="var">simpl_vector</span>; <span class="id" title="var">isRight_mono</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">MU</span></span> terminates, so does <span class="inlinecode"><span class="id" title="var">M</span></span>. This follows directly from <span class="inlinecode"><span class="id" title="var">MU_Realises</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <span class="id" title="var">EndTheorem1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k_MU</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">tp</span> <span class="id" title="var">tp'</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU</span> <span class="id" title="var">tp</span> (<span class="id" title="var">start</span> <span class="id" title="var">M'</span>) <span class="id" title="var">T</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">terminates</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">MU</span>) [|<span class="id" title="var">tp</span>|] <span class="id" title="var">k_MU</span> [|<span class="id" title="var">tp'</span>|] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">k_M</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">T'</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>), <span class="id" title="var">terminates</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span> <span class="id" title="var">k_M</span> <span class="id" title="var">T'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">T</span> <span class="id" title="var">k_MU</span> <span class="id" title="var">tp</span> <span class="id" title="var">tp'</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">HCont</span> (<span class="id" title="var">MU_finalConf</span>&amp;<span class="id" title="var">HMU_Term</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">MU_Realises</span> <span class="id" title="keyword">as</span> <span class="id" title="var">MU_Real</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">MU_Real</span>. <span class="id" title="tactic">specialize</span> <span class="id" title="var">MU_Real</span> <span class="id" title="keyword">with</span> (1 := <span class="id" title="var">HMU_Term</span>). <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">MU_Real</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HCont</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">T_Univ</span>&amp;<span class="id" title="var">HCont</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">evar</span> (<span class="id" title="var">s_Univ</span> : <span class="id" title="var">Vector.t</span> <span class="id" title="var">nat</span> 6).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">MU_Real</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">T</span> := <span class="id" title="var">T</span>) (<span class="id" title="var">s_Univ</span> := <span class="id" title="var">s_Univ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_assert</span> <span class="id" title="var">MU_Real</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">T'</span>&amp;<span class="id" title="var">M_finalState</span>&amp;<span class="id" title="var">M'_finalState</span>&amp;<span class="id" title="var">k_M</span>&amp;<span class="id" title="var">M_halts</span>&amp;<span class="id" title="var">M_finalCont</span>&amp;<span class="id" title="var">M_finalStateCorresponds</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">contains_conf_MU'_contains_conf_MU'_size</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">HCont</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">terminates</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <span class="id" title="var">EndTheorem2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> <span class="id" title="var">T'</span> : <span class="id" title="var">tapes</span> <span class="id" title="var">sigM</span> <span class="id" title="var">n</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tp</span> := <span class="id" title="var">initTapes_MU</span> <span class="id" title="var">T</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">terminates</span> <span class="id" title="var">M</span> <span class="id" title="var">T</span> <span class="id" title="var">k</span> <span class="id" title="var">T'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;contains_conf_MU&nbsp;tp&nbsp;(start&nbsp;M')&nbsp;T&nbsp;-&gt;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">tp'</span> : <span class="id" title="var">tape</span> <span class="id" title="var">sigMU</span>) (<span class="id" title="var">M'_final</span> : <span class="id" title="var">states</span> <span class="id" title="var">M'</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">terminates</span> (<span class="id" title="var">projT1</span> <span class="id" title="var">MU</span>) [|<span class="id" title="var">tp</span>|] (<span class="id" title="var">Mf</span> (<span class="id" title="var">k</span>, <span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span>)) [|<span class="id" title="var">tp'</span>|] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contains_conf_MU</span> <span class="id" title="var">tp'</span> <span class="id" title="var">M'_final</span> <span class="id" title="var">T'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sizeOfTape</span> <span class="id" title="var">tp</span> &lt;= <span class="id" title="var">space_constant</span> * (<span class="id" title="var">sizeOfmTapes</span> <span class="id" title="var">T</span> + 1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">T</span> <span class="id" title="var">T'</span> <span class="id" title="var">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="keyword">zeta</span>. <span class="id" title="tactic">set</span> (<span class="id" title="var">tp</span> := <span class="id" title="var">initTapes_MU</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">M_finalConf</span>&amp;<span class="id" title="var">M_halts</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;hnf&nbsp;in&nbsp;HCont.&nbsp;destruct&nbsp;HCont&nbsp;as&nbsp;(T_univ&amp;HCont&amp;HUnivContainsInitState).&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">MU_terminatesIn</span> <span class="id" title="keyword">as</span> <span class="id" title="var">MU_Term</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">MU_Term</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">MU_Term</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">tin</span> := [|<span class="id" title="var">tp</span>|])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">k</span> := <span class="id" title="var">MU_steps</span> (<span class="id" title="var">makeUnivTapes</span> (<span class="id" title="var">retr_sigSimGraph_sigUniv</span> <span class="id" title="var">_</span>) (<span class="id" title="var">retr_sigSimTape_sigUniv</span> <span class="id" title="var">_</span>) <span class="id" title="var">M'</span> (<span class="id" title="var">makeSingleTape</span> <span class="id" title="var">T</span>)) <span class="id" title="var">T</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_assert</span> <span class="id" title="var">MU_Term</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">MU_finalConf</span>&amp;<span class="id" title="var">MU_halts</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">do</span> 4 <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span> ]; <span class="id" title="tactic">eauto</span>. <span class="comment">(*&nbsp;don't&nbsp;<span class="inlinecode"><span class="id" title="tactic">split</span></span>&nbsp;too&nbsp;much&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">split</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeSingleTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivTapes_correct</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">MU_finalConf</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">MU_finalState</span>&amp;<span class="id" title="var">MU_finalTapes</span>). <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">vector_1_eta</span> <span class="id" title="var">MU_finalTapes</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">MU_finalTape</span>&amp;-&gt;).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">MU_Realises</span> <span class="id" title="keyword">as</span> <span class="id" title="var">MU_Real</span>. <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">MU_Real</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">MU_Real</span> <span class="id" title="keyword">with</span> (1 := <span class="id" title="var">MU_halts</span>). <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">MU_Real</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">MU_Real</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">MU_Real</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">T</span> := <span class="id" title="var">T</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">MU_Real</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">s_Univ</span> := <span class="id" title="var">Vector.const</span> 0 6).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_assert</span> <span class="id" title="var">MU_Real</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">T''</span>&amp;<span class="id" title="var">M_finalState</span>&amp;<span class="id" title="var">M'_finalState</span>&amp;<span class="id" title="var">k'</span>&amp;<span class="id" title="var">k_M'</span>&amp;<span class="id" title="var">M_halts'</span>&amp;<span class="id" title="var">M'_halts</span>&amp;<span class="id" title="var">M'_finalStatecontains</span>&amp;<span class="id" title="var">M'_finalStateCorrespond</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">makeSingleTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span> ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivWorkingTape_correct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivGraphTape_correct_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">makeUnivStartStateTape_correct_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">i</span>; <span class="id" title="var">destruct_fin</span> <span class="id" title="var">i</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">initRight_isRight_size</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;got&nbsp;another&nbsp;proof&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">M</span></span>&nbsp;halts.&nbsp;But&nbsp;this&nbsp;is&nbsp;not&nbsp;a&nbsp;problem&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">loop_injective</span> <span class="id" title="var">M_halts</span> <span class="id" title="var">M_halts'</span>. <span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">inv</span> <span class="id" title="var">H</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">MU_finalTape</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">M'_finalState</span>. <span class="id" title="tactic">split</span>; [ | <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">hnf</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">MU_finalState</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">loop_monotone</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Mfp_eq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Mf_bounded</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">contains_conf_MU_size_contains_conf_MU</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">space_constant_correct</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">initTapes_MU_correct_size</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">UnivMultiTimeSpaceTheorem</span>.<br/>

<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="keyword">Assumptions</span> <span class="id" title="var">EndTheorem1</span>.<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="keyword">Assumptions</span> <span class="id" title="var">EndTheorem2</span>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a>
</div>
</div>
</body>

</html>
